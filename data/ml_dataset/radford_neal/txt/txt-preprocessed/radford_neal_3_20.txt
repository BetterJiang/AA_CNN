Abstract.IshowhowtorunanN-time-stepMarkovchainsimulationinacircularfashion,
sothatthestateattimefollowsthestateattimeN(cid:0)inthesamewayasstatesattimes
tfollowthoseattimest(cid:0)for<t<N.Thiswrap-aroundofthechainisachievedusinga
couplingprocedure,andproducesstatesthatallhaveclosetotheequilibriumdistributionof
theMarkovchain,undertheassumptionthatcoupledchainsarelikelytocoalesceinlessthan
N=iterations.Thisprocedurethereforeautomaticallyeliminatestheinitialportionofthe
chainthatwouldotherwiseneedtobediscardedtogetgoodestimatesofequilibriumaverages.
Theassumptionofrapidcoalescencecanbetestedusingauxiliarychainsstartedattimes
spacedbetweenandN.Whenmultipleprocessorsareavailable,suchauxiliarychainscan
besimulatedinparallel,andpiecedtogethertogivethecircularly-coupledchain,inlesstime
thanasequentialsimulationwouldhavetaken,providedthatcoalescenceisindeedrapid.The
practicalutilityoftheseproceduresisdependentonthedevelopmentofgoodcouplingschemes,
butincontrasttoexactsamplingtechniquessuchascouplingfromthepast,thereisnoneed
toalsodeviseawayofkeepingtrackoflargesetsofstates.Ontheotherhand,althoughthe
assumptionsbehindcircularcouplingcanbetestedempirically,theresultswillnotprovidean
absoluteguaranteethatthepointsobtainedarefromtheequilibriumdistribution.




Introduction
SamplingfromacomplexdistributionbysimulatingaMarkovchainhavingthisdistributionas
itsequilibriumdistributionisanimportanttechniqueinstatisticalmechanics(eg,Frenkeland
Smit		),inBayesianstatistics(eg,Gilks,etal		),andinothercomputationalproblems
(eg,Sinclair		).Statesfromtheequilibriumdistributionofthechainarethenusedto
estimatequantitiesofinterest,suchastheaverageenergyofaphysicalsystem,oraBayesian
predictivedistribution.
Ideally,suchsimulationswouldbeconductedwiththeoreticalknowledgeofthetimeneeded
forthechaintoreachitsequilibriumdistributiontowithinagiventolerance.Althoughsome
progresshasbeenmadeatproducingquantitativeboundsonconvergencetimesofMarkov
chains(eg,Rosenthal		a),suchtheoreticalguaranteesarepresentlyunavailableformost
problemsofpracticalinterest.
Instead,practitionersusuallyassesstheconvergenceoftheMarkovchainsamplerempirically,
byformalorinformalmethods.Thesemethodsattempttodeterminewhetherthechain
hasreachedanadequateapproximationtoitsequilibriumdistributionwithinthenumberof
iterationssimulated.Ifitappearstohavedoneso,someinitialportionofthechain(the\burn-
in"period)isgenerallydiscardedinordertoavoidbiasingtheresultsbyinclusionofstates
thatre(cid:13)ectthestateinwhichthechainwasstartedratherthanitsequilibriumdistribution.
Thebewilderingvarietyofmethodsfordiagnosingconvergenceanddiscardinganappropriate
burn-inperiodhavebeenreviewedbyCowlesandCarlin(		),BrooksandRoberts(		),
andMengersen,etal(			).
Oneconvergencediagnostic,duetoJohnson(		),looksatmultiple\coupled"chainsthat
arestartedfromdi(cid:11)erentinitialstates,butthatsubsequentlyundergotransitionsdetermined
bythesamerandomnumbers.Rosenthal(		b)reviewstheapplicationofcouplingtoMarkov
chains.Brie(cid:13)y,couplingchainsintroducesdependenciesbetweenthem,andmayleadthem
to\coalesce"tothesamestateaftersomenumberofiterations.Theprobabilitythatachain
startedfromtheinitialstatedistributionhasnotcoalescedwithachainstartedfromthe
equilibriumdistributionbytimeTprovidesanupperboundonthetotalvariationdistanceof
thechainfromequilibriumattimeT.InJohnson'sdiagnostic,thetimerequiredforseveral
chainswhoseinitialstatesweredrawnfromadistributionthatismeanttobe\overdispersed"
withrespecttotheequilibriumdistributionistakenasaninformalindicationofhowmuch
timeisrequiredforapproximateequilibriumtobereached.
Onewayofviewingthecircularcouplingmethodofthispaperisasare(cid:12)nementofJohnson's
scheme,whichaddressestwoproblemsthatschemesu(cid:11)ersfrom.OneproblemnotedbyJohn-
sonisthatusingthestatesimmediatelyfollowingthetimewhenallchainscoalesceintroduces
abiasintheresults,favouringstateswherecoalescenceismorelikely.Thecircularcoupling
schemeofthispaperdiscardsaninitialportionofthechainwithoutintroducingbias(under
certainassumptions),byusingthelaststateofthechaintostartanewchainattimezero,and
usingthestatesofthischainratherthanoftheoriginalchainuptothepointwhereitandthe
originalchaincoalesce.AnotherproblemisthatalthoughJohnson'sschemeconsidersseveral
initialstates,itusesonlyasinglesequenceofrandomnumbers.
Itcouldbethatthisone
sequencehappenstoproduceatypicallyfastcoalescence.Diagnosticsinthecircularcoupling
schemearebasedonavarietyofstartingstatesattimesspacedthroughoutthetotalsimulation



period,therebye(cid:11)ectivelyconsideringvariousinitialrandomnumbersequences.Thisreduces
(butdoesnoteliminate)thepossibilitythattheresultswillbemisleadinglyoptimistic.
Thecouplingtechniqueofthispaperalsoprovidesawayofexploitingparallelcomputation
inMarkovchainsimulation.AsdiscussedbyRosenthal(			),therearemanypossibilities
forexploitingmultipleprocessorsfortheoveralltaskofestimatingquantitiesusingMarkov
chainMonteCarlomethods.However,thecoreoperationofsimulatingasinglerealizationof
aMarkovchainmightappeartobeinherentlysequential,sinceitmightseemthatthestateat
timetcannotbeobtaineduntilthestateattimet(cid:0)hasbeenfound.Inthispaper,however,
Iwillshowhowcouplingallowsonetousemultipleprocessorstosimulateasinglerealization
ofaMarkovchaininsubstantiallylesstimethatwouldberequiredbyasingleprocessor,
providedthattheMarkovchainandthecouplingmethodemployedleadtorapidcoalescence
ofchains.
Thepracticalfeasibilityofcircularcouplingisdependenton(cid:12)ndingane(cid:14)cientcoupling
scheme|ie,awayofintroducingdependenciesbetweenthetransitionsfromchainscurrently
indi(cid:11)erentstatesthatpromotestherapidcoalescenceofthesechainstothesamestate.
Generaltechniquesforachievingthisexist,oneofwhichwillbeintroducedhereandusedfor
somesimpledemonstrations.However,theremaywellbeacosttorestrictingtheMarkov
chainsusedtothoseforwhichgoodcouplingmethodsareavailable,andevenwhenasuitable
couplingschemeisavailable,itmaynotbeoptimal,andhencemayleadtocoalescencetimes
thataregreaterthantheactualtimerequiredfortheMarkovchaintoreachapproximate
equilibrium.
Thisneedforane(cid:14)cientcouplingschemeislessonerousthanforthealternativeofexact
(a.k.a.\perfect")samplingmethods,suchascouplingfromthepast(ProppandWilson		)
andtheinterruptibleschemeofFill(		).Forthesemethods,thecouplingschememustnot
onlypromotecoalescence,butalsopermitthee(cid:14)cienttrackingoflargesetsofstates,sothat
thecoalescenceofahuge(possiblyin(cid:12)nite)setofchainsstartedinallpossiblestatescanbe
determined.Circularcouplinglooksonlyatthecoalescenceofamoderatenumberofexplicitly
simulatedchains,andisthereforemucheasier.Thepriceofthisisthatcircularcouplingwill
notprovideanabsoluteguaranteethatthestatesobtainedarefromtheexactequilibrium
distribution,butonlyanassurancethattheyarefromclosetotheequilibriumdistribution,
providedthatcertainconditionsaremetwhosetruthcanbeempiricallytested,butnotveri(cid:12)ed
withcertainty.
 Thebasiccircularcouplingprocedure
Supposewewishtosamplefromadistribution(cid:25)forsomestatevariablexbyusingaMarkov
chainhaving(cid:25)asaninvariantdistribution.WehopethatthisMarkovchainisergodic,
andhencehas(cid:25)asitsonlyinvariantdistribution,andthatitconvergestothisequilibrium
distributionrapidly.
Realizationsofthischainwithdi(cid:11)erentinitialstatescanbecoupledbyrepresentingthe
transitionsofthechainbyafunction(cid:30)(xt;ut),whichtakesasargumentsthestateatsome
time,xt,andtherandomnumbersgeneratedatthattime,ut,andreturnsthestateofthe
chainatthenexttime,xt+.Therandomnumbersateachtimearedrawnindependently,each
fromthesamedistribution,U.Therewillbemanywaysofexpressingagivensetoftransition



probabilitiesinthisway,usingdi(cid:11)erenttransitionfunctions,(cid:30),anddi(cid:11)erentrandomnumber
distributions,U.Thesedi(cid:11)erentwaysofcouplingthechainsmayleadtocoalescenceoccurring
moreorlessrapidly.However,withanycouplingschemeofthisnature,oncetwochainshave
coalescedtothesamestateatsometime,theywillremaininthesamestateatallsubsequent
times.Withthisrepresentation,anordinaryMarkovchainsimulationforNtimestepsisconducted
asfollows:
StandardMarkovchainsimulation:
) Randomlydrawxfromtheinitialstatedistribution,p.
) Fort=;:::;N:
Randomlydrawut(cid:0)fromthedistributionU,independentlyofpreviousdraws.
Letxt=(cid:30)(xt(cid:0);ut(cid:0)).
Acircularly-coupledMarkovchainsimulationforNtimestepsbeginsthesamewayasa
standardsimulation,butaftergeneratingx;:::;xN,asecondsetofstates,y;:::;yN,are
generatedbylettingy=xNandthenredoingthesimulationfromthisstartingpoint,using
thesamerandomnumbers,u;:::;uN(cid:0),asbefore.Ifthechainstartedfromycoalesceswith
theoriginalchainbeforetimeN,thereisnoneedtoperformanyfurthercomputations,since
eachytfromthattimeonwillbethesameasthecorrespondingxt.Hereisthebasicprocedure
(withoutthediagnosticsthatwillbeaddedinSection),whichisalsoillustratedinFigure:
Basiccircularly-coupledMarkovchainsimulation:
) Randomlydrawxfromtheinitialstatedistribution,p.
) Fort=;:::;N:
Randomlydrawut(cid:0)fromthedistributionU,independentlyofpreviousdraws.
Letxt=(cid:30)(xt(cid:0);ut(cid:0)).
)
Lety=xN.
) Fort=;:::;Nwhileyt(cid:0)=xt(cid:0):
Letyt=(cid:30)(yt(cid:0);ut(cid:0)).
)
Lettheremainingytbethesameasthecorrespondingxt.
Inpractice,pseudo-randomnumberswouldgenerallybeused,eliminatingtheneedtosave
u;:::;uN(cid:0)|instead,thepseudo-randomnumbergeneratorcansimplybere-initialized
usingtheoriginalseed.Iftheamountofmemoryneededtosaveastateislarge,thevalues
ofx;:::;xN(cid:0)mightnotbesavedwhentheyare(cid:12)rstgenerated,butinsteadberecomputed
asy;y;:::aregenerated.Thisapproachmightbepreferablewhencoalescenceofy;y;:::
withx;x;:::isexpectedtoberapid.Ofcourse,thevaluesoffunctionsofthestatethatare
ofinterestwillstillneedtobesaved,sothatestimatescanintheendbecomputedforthe
expectationsofthesefunctions.
Ifthewrapped-aroundchainfailstocoalescewiththeoriginalchain(ie,ifyN=xN),
theproceduremaybeseenashavingfailed.Theprojectofsamplingfrom(cid:25)mightthen



x  ~ p0

0

0

N

0

N

N

x   = y
0

Figure:Thebasiccircularcouplingprocedure.Inthisillustration,thereal-valuedstateis
plottedontheverticalaxis,andsimulationtimeisonthehorizontalaxis.Theplotontheleft
showsthegenerationoftheoriginalchain,x;:::;xN,startingwithastatedrawnfromthe
distributionp.Theplotontherightshowsthesubsequentgenerationofthewrapped-around
chain,y;:::;yN.Inthiscase,thetwochainscoalesceatt=.
beabandoned,ortheproceduremightberedonewithasubstantiallylargervalueforN.
Forpurposesoftheoreticalanalysis,however,Iwillassumethattheytfort=;:::;N(cid:0)
arealwaystreatedasasamplefromtheequilibriumdistributionofthechain,andusedto
estimateexpectationsoffunctionswithrespecttothisdistribution,evenifcoalescencedidnot
occur.(NotethatsinceyN=ywhencoalescencedoesoccur,thesepointsshouldnotboth
beincludedinthesample,asthispointwouldthencountdouble.)Inthenextsection,Ishow
thatalltheseytwillindeedhaveapproximatelytheequilibriumdistribution,providedcertain
assumptionsregardingspeedofcoalescencearesatis(cid:12)ed.Ofcourse,theytwillgenerallybe
dependent,andthiswillneedtobeaccountedforwhenassessingtheaccuracyoftheestimates
obtained,aswithstandardMarkovchainMonteCarloprocedures.
 Proofofapproximatecorrectness
Thefollowingtheoremguaranteestheapproximatecorrectnessofcircularcoupling,under
certainassumptions:
Theorem:Eachpointyt,fort=;:::;N,thatisgeneratedbythebasiccircularly-coupled
MarkovchainsimulationprocedurewithagivenN(assumedheretobeeven)hasadistribution
thatiswithin(cid:15)+(cid:14)oftheequilibriumdistribution,(cid:25),intotalvariationdistance,provided(cid:15)
and(cid:14)aresuchthatthefollowingconditionsholdregardingcoupledchains(ie,chainsthatare
simulatedusingthesamerandomnumbersequence,u;u;:::):
)Iftwochainsarestartedfromstatesdrawnfromtheequilibriumdistribution,(cid:25),indepen-
dentlyofeachother,andoftheut,theywillcoalescewithinN=iterationswithprobability
atleast(cid:0)(cid:15).
)Ifachainisstartedfromastatedrawnfrom(cid:25),independentlyoftheut,andanother
chainisstartedfromastatedrawnfromthedistributionp,independentlyoftheinitial
Here,thetotalvariationdistancebetweendistributions(cid:22)and(cid:23)isde(cid:12)nedtobesupAj(cid:22)(A)(cid:0)(cid:23)(A)j,where
thesupremumisoveralleventsA.Totalvariationdistanceissometimesgivenanalternativede(cid:12)nitionthatis
twicethis.



stateoftheotherchainandoftheut,thenthetwochainswillcoalescewithinNiterations
withprobabilityatleast(cid:0)(cid:14).
Theprooflooksatanotherwayofgeneratingthesequencey;:::;yN,alongwithx;:::;xN,
bymeansoftheproceduregivenbelow,andillustratedinFigure.
Theoreticalcircularcouplingprocedure:
) Randomlydrawxfromtheinitialstatedistribution,p.
) Fort=;:::;N:
Randomlydrawut(cid:0)fromthedistributionU,independentlyofpreviousdraws.
Letxt=(cid:30)(xt(cid:0);ut(cid:0)).
) RandomlydrawvandwN=from(cid:25),eachindependentlyoftheotherandoftheut.
) Fort=;:::;N=:Letvt=(cid:30)(vt(cid:0);ut(cid:0)).
Fort=N=+;:::;N:Letwt=(cid:30)(wt(cid:0);ut(cid:0)).
Letv(cid:3)N==vN=andw(cid:3)=wN.
)
) Fort=N=+;:::;N:Letv(cid:3)t=(cid:30)(v(cid:3)t(cid:0);ut(cid:0)).
Fort=;:::;N=:Letw(cid:3)t=(cid:30)(w(cid:3)t(cid:0);ut(cid:0)).
Letyt=w(cid:3)tfort=;:::;N=(cid:0)andletyt=v(cid:3)tfort=N=;:::;N.
)
Thegenerationofx;:::;xNinsteps()and()aboveisthesameasforthepracticalcircular
couplingprocedureoftheprevioussection,buttherestofthetheoreticalprocedurecould
notbecarriedoutinpractice,sinceitrequiressamplingdirectlyfrom(cid:25),whichispresumably
infeasible.
However,wecanusethistheoreticalproceduretoprovetheapproximatecorrectnessofthe
practicalcircularcouplingprocedure.First,wewillseethattheytproducedbythetheoretical
procedureallhavedistribution(cid:25).Second,whenthetwoconditionsofthetheoremhold,we
willseethatthedistributionofytobtainedwiththetheoreticalprocedureisapproximately
thesameasforthepracticalprocedure.
Thateachoftheytobtainedusingthetheoreticalprocedurehasdistribution(cid:25)followseasily
aslongas(cid:25)isaninvariantdistributionoftheMarkovchainde(cid:12)nedbythefunction(cid:30)and
therandomnumberdistributionU|ie,aslongasthedistributionof(cid:30)(x;u)is(cid:25)whenxhas
distribution(cid:25)anduhasdistributionU,independentofx.Fromthis,itfollowsthatallthe
vtandv(cid:3)tandallwtandw(cid:3)thavedistribution(cid:25),sincetheyareproducedbytransitionsthat
leave(cid:25)invariant,startingfromastatedrawnfrom(cid:25).Sinceeachytisde(cid:12)nedtobeequalto
eitherw(cid:3)torv(cid:3)t,theytmustallhavedistribution(cid:25)aswell.
Forthesecondpartoftheproof,we(cid:12)rstnotethatwhenthetwoconditionsofthetheorem
hold,thefollowingeventsoccurwiththeindicatedprobabilities:
a)vN==w(cid:3)N=withprobabilityatleast(cid:0)(cid:15).
b)wN=v(cid:3)Nwithprobabilityatleast(cid:0)(cid:15).
c)xN=v(cid:3)Nwithprobabilityatleast(cid:0)(cid:14).


w    ~

N/2


v  ~
0

w  = w
*
0

N

N/2v   = v
*
N/2

0

N/2

N

0

N/2

N

0x  ~ p

0

N

0

N

0

N/2

N/2

Figure:Proofofapproximatecorrectness.Thevtandv(cid:3)tareshownas+signs,thewtandw(cid:3)t
as(cid:2)signs,theytassquares,andthextasdots.Thetopleftshowsgenerationofv;:::;vN=
andwN=;:::;wNstartingfromstatesdrawnfrom(cid:25).Thetoprightshowsthecontinuation
ofthesesequences,vN==v(cid:3)N=;:::;v(cid:3)NandwN=w(cid:3);:::;w(cid:3)N=.
Inthebottomleft,the
sequencey;:::;yNusedforestimationisidenti(cid:12)ed.Thebottomrightshowsasequence
x;:::;xNstartedfrompcoalescingwiththesequencey;:::;yN,permittingthissequence
tobefoundwithouttheneedtosamplefrom(cid:25).


Forevent(a),thisfollowsfromCondition()becausevN=andw(cid:3)N=aretheresultofN=
iterationswiththesameut(fort=;:::;N=(cid:0)),startingfrompointsvandw(cid:3)thatare
bothdrawnindependentlyfrom(cid:25),independentlyoftheseut.Thatw(cid:3)=wNisdrawnfrom(cid:25)
followsfromitbeingproducedfromwN=,whichisdrawnfrom(cid:25),byapplyingtransitionsthat
leave(cid:25)invariant.Notethatthesetransitionsarede(cid:12)nedintermsofutfort=N=;:::;N(cid:0),
whichdoesnotoverlapthesetofutabove.Theboundontheprobabilityofevent(b)follows
fromCondition()similarly,andtheboundontheprobabilityofevent(c)followsfrom
Condition().
Theeventof(a),(b),and(c)alloccurringhasprobabilityatleast(cid:0)(cid:15)(cid:0)(cid:14),because
theprobabilitythatatleastoneof(a),(b),and(c)willnotoccurisatmost(cid:15)+(cid:14)(this
boundisvalideventhoughthethreeeventsmaynotbeindependent).Whenthishappens,
xN=v(cid:3)N=wN=w(cid:3)=y.Furthermore,yt=(cid:30)(yt(cid:0);ut(cid:0))fort=;:::;N|thisisobvious
foralltexceptN=,andforthatt,itisaconsequenceofv(cid:3)N==vN==w(cid:3)N=.Whenallof(a),
(b),and(c)occur,thevaluesofytgeneratedwillthereforebethesameaswouldbegenerated
bythebasiccircularcouplingprocedure.
Fromthecouplinginequality(Lindvall		),wecanboundthetotalvariationdistance
betweenthedistributionofy;:::;yN(cid:0)asproducedbythepracticalprocedureandthedis-
tributionofy;:::;yN(cid:0)asproducedbythetheoreticalprocedurebytheprobabilityofthese
sequencesdi(cid:11)ering,whichwehaveseenisinturnboundedaboveby(cid:15)+(cid:14).Thetotalvariation
distancebetweenthedistributionsofanyindividualytforthetwoproceduresisboundedby
thesamequantity.Sincethedistributionofeachytproducedbythetheoreticalprocedureis
(cid:25),weseethatthedistributionofeachytproducedbythepracticalprocedureiswithin(cid:15)+(cid:14)
of(cid:25)intotalvariationdistance.
 Testingtheconditionsforapproximatecorrectness
Conditions()and()requiredfortheapproximatecorrectnessofthecircularcouplingpro-
cedurewillseldombeveri(cid:12)abletheoretically.Instead,wewillhavetocontentourselveswith
anempiricaldiagnostictest.
ThisteststartsbytentativelyassumingthatthetwoconditionsaretrueforthevalueofN
weareusing,andforsomefairlysmallvaluesof(cid:15)and(cid:14).Ifso,thevalueofeachytobtained
shouldcomefromclosetotheequilibriumdistribution(cid:25).Althoughytwillnotbecompletely
independentofut;ut+;ut+;:::,thedependenceshouldinpracticebesu(cid:14)cientlyslightthat
wecanseeyt;yt+;yt+;:::asarealizationoftheMarkovchainstartedatequilibrium,atleast
aslongaswelookonlyuptoyt+kwithk(cid:28)N.(Hereandbelow,additionandsubtractionon
timesisdonemoduloN,sothatift=N(cid:0),thenyt+referstoy.)
Condition()statesthatsuchasequence,yt;yt+;yt+;:::,willwithhighprobabilitycoa-
lescewithinNiterationswithanothercoupledchainstartedinastatedrawnfromtheinitial
statedistributionp.ChoosingsomerthatdividesN,wecantestwhetherthisinfactoccurs
whenstartingattimest=N=r;N=r;:::;(r(cid:0))N=rbysimulatingauxiliarychainsstarting
atthosetimes.Inpractice,wewouldusuallywishforcoalescencetooccurinconsiderably
fewerthanNiterations,soletussupposethatwesimulateeachsuchchainforonlysome
numberk<N=iterations,oruntiltheauxiliarychaincoalesceswithyt;yt+;yt+;:::



Thisleadstothefollowingextensionofthebasiccircularcouplingprocedure:
Circularly-coupledMarkovchainsimulationwithauxiliarydiagnosticchains:
-)Performsteps()to()ofthebasiccircularly-coupledMarkovchainsimulation
procedure.
)
Letcbethenumberofstepsneededforthewrapped-aroundchaintocoalescewith
theoriginalchain|ie,letcbethesmallesttsuchthatyt=xt|unlessthechains
donotcoalescewithinkiterations,inwhichcaseletc=k.
) Fori=;:::;r(cid:0):
Lets=iN=r.
Randomlydrawzi;sfromtheinitialstatedistribution,p.
Setci=.
Fort=s+;:::;s+k(moduloN)whilezi;t(cid:0)=yt(cid:0):
Letzi;t=(cid:30)(zi;t(cid:0);ut(cid:0)).
Setci=ci+.
ThetimerequiredforthisprocedurewillberoughlyproportionaltothenumberofMarkov
chainiterations(ie,thenumberofevaluationsof(cid:30)),whichwillbeN+Pici.Notethatifall
theauxiliarychainscoalescewiththewrapped-aroundchain,y;:::;yN,therewillbenoreal
distinctionbetweentheauxiliarychainsandtheoriginalchainthatwasstartedwithxdrawn
fromp.Thesamewrapped-aroundchainwouldhavebeenfoundfromanyoftherstarting
points.Thevaluesofcifori=;:::;r(cid:0)thatareobtainedbythisprocedureareindicativeof
whetherCondition()holds.Ifmanyoftheciaregreaterthank,weshouldnotbecon(cid:12)dent
thatthisconditionholds,andshouldrerunthesimulationwithalargervalueforkandprobably
alargervalueforNaswell(recallthatkshouldbesubstantiallysmallerthanN).Itmay
oftenbereasonabletothinkthatthecihaveanapproximatelygeometricdistribution,inwhich
casetheparameterofthisdistributioncouldbeestimatedfromthis(right-censored)data,and
usedtoestimatethevalueof(cid:14)forwhichCondition()holds.
ThistestdoesnotprovidedirectinformationaboutCondition(),whichinvolvestwochains
startedfromtheequilibriumdistribution.However,iftheevidencefromtheauxiliarychains
leadsonetoconcludethatallbutasmallfraction,q,ofchainsstartedfrompcoalesceinno
morethanN=iterationswithachainstartedfromtheequilibriumdistribution,thenonecan
alsoconcludethattwochainsstartedfromtheequilibriumdistributionwillcoalescewitheach
otherwithinN=iterationswithprobabilityatleast(cid:0)q,sinceiftheybothcoalescewitha
chainstartedfromp,theymustalsocoalescewitheachother.
Ifalltheauxiliarydiagnosticchainsareobservedtocoalescequicklywiththewrapped-around
chain,wethereforehavereasontobelievethatbothconditionsforapproximatecorrectness
hold.Thiswillnotbeanabsoluteguarantee,however.
Itcouldbethattheinitialstate
distribution,p,giveslittleprobabilitytoaregionthathashighprobabilityunder(cid:25),and
thatisisolatedfromtheregionsthatdohavehighprobabilityunderp.Boththewrapped-
aroundchainandtheauxiliarydiagnosticchainsmightnevervisitthisisolatedregion,inwhich


casethediagnosticchainswouldpresentaself-consistentbutdrasticallyincorrectpictureofthe
distributionofcoalescencetimes.Tohelpavoidthis,itisdesirableforptobe\overdispersed"
withrespectto(cid:25),butevenifthisisso,thereisnoguaranteethatallhighprobabilityregionsof
(cid:25)willbefound,sincesomeregionwithalargeprobabilityunder(cid:25)mighthaveasmall\basin
ofattraction",andhencecouldbemissedevenifitiswithinthehighprobabilityregionofp.
 Parallelsimulation
Theauxiliarychainsusedasdiagnosticsintheprevioussectionareexpectedtocoalescewith
thewrapped-aroundchainreasonablyrapidly.Ifthisisindeedso,coalescenceofeachauxiliary
chainwiththenextauxiliarychain(startedN=rtimestepsforward)willalsobefairlyrapid.
Itwillthenbepossibleto(cid:12)ndthewrapped-aroundchainbyparallelcomputationonseveral
processors,inlesstimethanwouldbeneededtosimulatethewrapped-aroundchainusinga
singleprocessor.Thefollowingprocedureisbasedonthisidea:
Parallelsimulationofacircularly-coupledMarkovchain:
Inparallel,processorsnumberedbyi=;:::;r(cid:0)dothefollowing:
(Thevariabless,t,andzarelocaltoeachprocessor)
)Lets=iN=r.
)Fort=s;:::;s+N=r(cid:0):
RandomlydrawutfromthedistributionU,independentlyofotherdraws.
)Randomlydrawysfromthedistributionp,independentlyofotherdraws.
)Fort=s+;:::;s+N=r(cid:0):
Setyt=(cid:30)(yt(cid:0);ut(cid:0)).
)Setz=(cid:30)(ys+N=r(cid:0);us+N=r(cid:0)).
)Sendztoprocessori+(modulor)asthenewvalueforys+N=r.
)Repeatthefollowing:
Waitforanewvalueforystobereceivedfromprocessori(cid:0)(modulor).
Fort=s+;:::;s+N=r(cid:0)whileyt=(cid:30)(yt(cid:0);ut(cid:0)):
Setyt=(cid:30)(yt(cid:0);ut(cid:0)).
Ifz=(cid:30)(ys+N=r(cid:0);us+N=r(cid:0)):
Setz=(cid:30)(ys+N=r(cid:0);us+N=r(cid:0)).
Sendztoprocessori+(modulor)asthenewvalueforys+N=r.
Theprocedureterminateswhenallprocessorsarewaiting.
Thewrapped-aroundchainconsistsofthe(cid:12)nalvaluesofy;:::;yN(cid:0)thatarestoredinther
processors.Thesubscriptofywrapsaroundintheaboveprocedure,sothatprocessorr(cid:0)
sendsyNtoprocessor,whichusesittoreplacetheoldvalueofy.Anordinary,non-circular
Markovchainsimulationcanbeperformedinparallelinthesamewayasabovebyomitting


thiswrap-around,keepingy(cid:12)xedatitsoriginalvalue,butIwillnotdiscussthispossibility
furtherhere.
Thecomputationtimefortheabovesimulationwillbeatleastthetimerequiredtosimulate
N=rMarkovchainiterations,sincethatmanyiterationswillalwaysbedoneinsteps()and
().Eachprocessorwillthenbeginsimulatingachainstartingfromthenewvaluereceived
foritsys.IfeachofthesechainscoalesceswithinN=riterationswiththechainsthatwere
simulatedstartingfromtheoriginalvaluesforeachys,theneachprocessorwill(cid:12)ndthatthe
valueforys+N=rthatitcommunicatestothenextprocessorisunchanged,andtheentire
procedurewillterminate.ThetimetakenwillbethatrequiredforbetweenN=randN=r
Markovchainiterations.
If,onthecontrary,notallofthesechainscoalescewithinN=riterations,oneormoreof
theprocessorswillhavetoperformathirdsimulation.Ingeneral,aprocessormighthave
torerunitssimulationanynumberoftimes,asaresultofthepreviousprocessorsendingit
newstartstates.Assumingthatasequentialsimulationwouldhaveresultedinthewrapped-
aroundchaincoalescingwiththeoriginalchain,thetimerequiredfortheparallelsimulation
willberoughlyproportionaltothemaximumnumberofiterationsthatanyoftherchains
withdi(cid:11)erentstartingpointstaketocoalescewiththiswrapped-aroundchain.Ifthistimeis
comparabletothetimeforasequentialsimulation,theslowcoalescenceoftheauxiliarychain
wouldbeindicativeofaproblem,anditwouldusuallybebesttostopthewholeprocedure,
andrestartitwithalargervalueforN.
Itispossiblethattheprocedureasshownwillnotterminate.Thiswillhappenifdi(cid:11)erent
startingpointsleadtodi(cid:11)erentwrapped-aroundchains;FigureinSectionbelowillustrates
thispossibility.
Inpractice,theprocedureshouldbeterminatedwhensomeprocessorhas
receivedmorethansomemaximumofnewvaluesforitsstartingpoint.Themaximumnumber
ofsuchnewstartingpointsisaroughdiagnosticofhowrapidlythechainscouple,providing
informationsimilartothatprovidedbytheciintheprocedureofSection.
Thisparallelsimulationproceduremaybeadaptabletovectorcomputation,providedthe
computationof(cid:30)doesnotinvolvelotsofconditionalcomputations.Suchavectorizedsim-
ulationmightbeappropriatewhenvectoroperationsaresupportedbyhardware,orwhen
programmingisdoneinaninterpretedlanguageinwhichvectoroperationsarenotmuch
slowerthanscalaroperations,duetothe(cid:12)xedoverheadofinterpretation.
Finally,oneshouldnotethatalthoughtheparallelsimulationprocedureaimstodoroughly
whatisdonebythesequentialprocedurewithauxiliarydiagnosticchainsofSection,the
actualcomputationsdonemaydi(cid:11)er.Whennotallchainscoalescewiththewrapped-around
chainwithinN=riterations,thesequentialprocedureofSectionwillsimulatetwoormore
chainsthatoperateatthesametimes.Itispossiblethatthesechainswillcoalescewitheach
otherbeforecoalescingwiththewrapped-aroundchain,butthesequentialproceduredoesnot
detectthis,andwillsimulatethecoalescedchainsseparately.Coalescenceofchainsisdetected
di(cid:11)erentlyintheparallelprocedure,however,whichmayleadtosuchportionsofchainsbeing
simulatedonlyonce.
Itisthereforeconceivablethatitwouldbeadvantageoustousethe
parallelprocedureevenwhenonehasavailableonlyasingleprocessor,whichcouldexecute
therparallelprocessesofthealgorithmbytimesharing.


 AMetropoliscouplingscheme
Tobepracticallyuseful,thecircularcouplingprocedureneedsarepresentationoftheMarkov
chaintransitionsintermsofa(cid:30)functionthatiseasilycomputable,andthatleadstorapid
coalescenceofchains.Exactsamplingmethodssuchascouplingfromthepast(Proppand
Wilson		)alsorequiresucharepresentation,asdothecoupling-basedschemesofJohn-
son(		,		).Severalsuchschemeshaverecentlybeendiscussedinthecontextofexact
samplingbyGreenandMurdoch(		).NotethatoneisatlibertytochoosetheMarkov
chaintransitionstofacilitatecoupling,thoughthismightsometimescomeatacostinterms
ofconvergencerate.
Iwillnotdiscusscouplingschemesinanydepthinthispaper.
Instead,Iwillpresenta
simplecouplingschemeforMetropolisupdatesincontinuousstatespacesthatleadstoexact
coalescencewithpositiveprobability,whichIwilluseinthedemonstrationsinthenextsection.
Onitsown,thisschemewillnotbeadequateforallrealproblems,butitmaybegenerally
usefulinproducingexactcoalescenceonceothermethodshavebroughtthechainstonearby
states.Supposethatourstate,x,consistsofasinglerealvalue,andthatourdesireddistributionis
givenbythedensityfunction(cid:25)(x).RecallthattheMetropolisalgorithmde(cid:12)nesaMarkovchain
transitionintermsofadensityfunction,g(x(cid:3)jx),forproposingamovetostatex(cid:3),giventhat
thechainiscurrentlyinstatex.Thisproposalisacceptedwithprobabilitymin[;(cid:25)(x(cid:3))=(cid:25)(x)].
Iftheproposalisrejected,thenewstateisthesameastheoldstate.Providedthatthe
proposaldistributionissymmetrical(ie,g(x(cid:3)jx)=g(xjx(cid:3))),thisupdateleavesthedistribution
(cid:25)invariant.
Iwillconsiderarandom-walkMetropolisalgorithmusingproposalsthatareuniformlydis-
tributedinanintervalofwidthw,centredonthecurrentstate,forwhich
g(x(cid:3)jx)=(=wifjx(cid:3)(cid:0)xj<w=
()
otherwise

Themostobviouswayofexpressingthisupdateintermsofafunction(cid:30)isasfollows:
(cid:30)(x;u)=(x+w(u(cid:0)=)
ifu<(cid:25)(x+w(u(cid:0)=))=(cid:25)(x)
()
x
otherwise
ThisfunctiontakesthecurrentstateandavectoroftwoUniform(;)randomnumbersas
arguments,andreturnsthenextstate,whichwillhavethedistributionasde(cid:12)nedforthe
Metropolisalgorithmwiththeproposaldistributionabove.However,withthis(cid:30)function,the
probabilityofexactcoalescenceofchainsiszero,wheneverthecurrentstatesaredistinct.
Fortunately,thesameMarkovchaintransitionprobabilitiesareobtainedwiththefollowing
(cid:30)function,whichcanleadtocoalescencewithpositiveprobability:
(cid:30)(x;u)=(f(x;u)
ifu<(cid:25)(f(x;u))=(cid:25)(x)
()
x
otherwise
wheref(x;u)=w[(u(cid:0)=)+Round(x=w(cid:0)(u(cid:0)=))]
Roundreturnstheintegernearestitsargument.Thefunctionf(x;u)canbeseenas(cid:12)rst
transformingthestatetox=x=w(cid:0)(u(cid:0)=),thenroundingtothenearestinteger,then


applyingtheinversetransformation.Clearly,foragivenvalueofu,arangeofvaluesforxof
widthwwillallresultinthesamevalueforf(x;u).Twochainswhosecurrentstatesarein
thisrange,andforwhichtheproposedpointisaccepted,willthereforecoalesceexactlyasa
resultofthistransition.
This(cid:30)functioncanbevisualizedas(cid:12)rstlayingdownagridofpointsspacedwapart,with
thepositionofthegridbeingchosenuniformlyatrandom,andthenproposingtomovetothe
pointonthisgridthatisnearestthecurrentstate,x.Itisthenclearthatthedistributionof
theproposedstateisasinequation().Theschemegeneralizesdirectlytohigherdimensions,
inwhichtheproposaldistributionisuniformoverahypercubecentredonthecurrentstate,
bysimplyusingahigher-dimensionalgrid.
 Simpledemonstrations
Toillustratetheconceptofcircularly-coupledMarkovchainsimulation,Iincludeheretwo
simpleillustrationswithaone-dimensionalstatespace.Bothexamplesusetherandom-walk
Metropolisalgorithmbasedontheuniformproposaldistributionofequation(),withw=,
coupledusingtheschemeofequation().
The(cid:12)rstexampleillustratesthebehaviourofcircularcouplingwhencoalescenceisrapid.
FigureshowsasimulationoflengthN=thatsamplesfromtheN(;)distribution,
withN(;)astheinitialstatedistribution.Tenchainsweresimulatedintotal|one
startedatt=,plusnineauxiliarychainsstartedatt=;;:::;	.Allchainscoalesce
rapidlywiththewrapped-aroundchain,anindication(butnotanabsoluteguarantee)that
theconditionsforthestatesofthewrapped-aroundchaintoallcomefromtheequilibrium
distributionaresatis(cid:12)ed.
Thesecondexampleillustrateshowcircularcouplingbehaveswhencoalescenceisless
rapid.Thedistributiontobesampledfromisinthiscaseabimodalmixtureofnormals,
(=)N((cid:0);)+(=)N(:;:).Figureshowsacircularly-coupledsimulationforthisdis-
tributionthatistypicalofrunsoflengthN=,withr=startingpoints.Someof
thetenchainsstartedwithstatesfromtheN(;)distributioncoalescerapidly,asforthe
(cid:12)rstexample,butothersdonot.Inparticular,thechainstartedatt=	takesabout
iterationstocoalescewiththewrapped-aroundchain.Thisisevidencethattheconditions
neededforthestatesofthewrapped-aroundchaintocomefromapproximatelythecorrect
distributionmaynotbesatis(cid:12)ed.
Figureshowsanotherrunofthesamesimulation,withadi(cid:11)erentpseudo-randomnumber
seed.Thisrunmightwellbemisleading,sincethewrapped-aroundchainfoundsamplesfrom
onlythelowerofthemixturedistribution'stwomodes.Moreover,thechainsfromallten
startingpointscoalescewiththiswrapped-aroundchainreasonablyquickly,whichmightlead
onetothinkthattheprocedureissamplingfromapproximatelythecorrectdistribution.The
distributionofstatesproducedbythisproceduremightindeedbeatleastroughlycorrect,
sinceasseenintheprevious(cid:12)gure,otherrunsofthesamesimulationproceduredoproduce
wrapped-aroundchainsthatvisittheuppermodeaswell.However,evenifthedistribution
ofeachstateofthewrapped-aroundchainforN=isclosetocorrect,thestatesin
thischainareclearlyhighlydependent,andhenceasinglewrapped-aroundchaincanfailto
provideanadequatesample.Behavioursimilartothisoccursinafewpercentoftheruns.



10

8

6

4

2

0

2

4

6

700

800

900

600

400

500

200

300

8

0

100

1000

Figure:Acircularly-coupledrandom-walkMetropolissimulationsamplingfromtheN(;)
distribution.TenchainsstartedwithstatesdrawnfromtheinitialdistributionN(;)(shown
ascircles)allcoalescewiththewrapped-aroundchain(thethickline)inlessthaniterations,
muchlessthanthetotalof.Thisisconsistentwiththeconditionsrequiredforthecircular
couplingproceduretobeapproximatelycorrect.


4

2

0

2

4

6

Figure:Acircularly-coupledrandom-walkMetropolissimulationsamplingfromthedis-
tribution(=)N((cid:0);)+(=)N(:;:).Oneofthetenchainsstartedfromtheinitial
distributionN(;)takesiterationstocoalescewiththewrapped-aroundchain.Since
thisisasubstantialfractionofthetotalofiterations,onemightdoubtwhetherthe
conditionsforthecircularcouplingproceduretobeapproximatelycorrectaresatis(cid:12)ed.

1000

100

8

0

200

300

400

500

600

700

800

900



6

4

2

0

2

4

6

8

10

12

Figure:Anotherrunofthecircularly-coupledsimulationshowninFigure.Thistimethe
tenchainsallcoalescewithawrapped-aroundchainthathasvisitedonlythelowerofthetwo
modes.

1000

14

0

200

300

400

500

100

600

700

800

900



8

6

4

2

0

2

4

6

8

Figure:Arunofthesamecircularly-coupledsimulationasinFigureinwhichasingle
wrapped-aroundchainwasnotfoundaftersimulatingeachchainforNiterations.Instead,six
ofthechainscoalescedintoawrapped-aroundchainthatstaysintheuppermode,whilethe
otherfourchainscoalescedintoawrapped-aroundchainthatstaysinthelowermode.

1000

100

10

0

200

300

400

500

900

600

700

800



Usingmorethantenrandomstartingpointswouldreducethechancesofsuchaproblem
remainingundiagnosed.
Figureshowsanotherpossibleresultofthesimulationprocedure,whichoccursaboutonce
inathousandruns.Here,sixofthetenchainscoalescetoawrapped-aroundchainthatmoves
withintheuppermodeonly.Thechainsstartedfromtheotherfourinitialstatescoalesceto
awrapped-aroundchainthatmoveswithinthelowermode.Whenthissituationoccurs,one
cantellthatthesimulationshouldbererunwithalargervalueofN.
 Discussion
Thecircularcouplingprocedurehasbeenshownheretoproducestateswithapproximatelythe
correctdistributionprovidedcertainconditionsregardingcoalescencetimesaresatis(cid:12)ed.In
practice,wewillusuallynotknowwithcertaintywhethertheseconditionshold,butdiagnostic
testscanprovideusefulevidenceofthis.
Ifwedidhaveatheoreticalproofthattherequiredconditionshold,thebene(cid:12)tsofcircular
couplingwouldbemodest.Theseconditionswouldalsosu(cid:14)cetoshowthatthedistributionof
thelaststateofanordinaryMarkovchainsimulationforNtimestepscomesfromclosetothe
equilibriumdistributionofthechain.WecouldthereforeobtainasampleofN(dependent)
pointsfromapproximatelythecorrectdistributionbysimplycontinuingthesimulationofthis
chainforanotherNiterations.Thecircularcouplingprocedurewouldsaveatmostafactorof
twoincomputationtimecomparedtothisalternative,lessifcoalescenceofthewrapped-around
chaindidnotoccurquickly.
Theprimaryreasonwhycircularcouplingisofinterestisthatitmayprovideawayof
diagnosingconvergenceanddiscardinga\burn-in"periodthatismoreautomaticthancurrent
methods,allowingMarkovchainMonteCarlomethodstobeusedonamoreroutinebasis.
Theabilityofcircularcouplingtoexploitparallelcomputationmayalsobeusefulinpractice.
Toobtainthesebene(cid:12)ts,e(cid:11)ectivecouplingschemeswillneedtobedeveloped,whichcanbe
appliedtoawiderangeofdistributionswithlittleornoneedforproblem-speci(cid:12)ctailoring.
Acknowledgements
IthankJe(cid:11)reyRosenthalforinspirationtoexaminethepossibilityofparallelsimulationof
Markovchainsandforhelpfuldiscussions.ThisresearchwassupportedbytheNaturalSciences
andEngineeringResearchCouncilofCanada,andbytheInstituteforRoboticsandIntelligent
Systems.
