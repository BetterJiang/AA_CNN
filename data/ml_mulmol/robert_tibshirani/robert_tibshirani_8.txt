introduction .
we discuss the problem of identifying differentially ex - pressed groups of genes from a set of microarray experiments .
in the usual situation we have n genes measured on n microarrays , under two different ex - perimental conditions , such as control and treatment .
the number of genes n is usually large , say , at least a few thousand , while the number samples n is smaller , say , a hundred or fewer .
this problem is an example of multiple hypothesis testing with a large number of tests , one that often arises in genomic and proteomic ap - plications , and also in signal processing .
we focus mostly on the gene expression problem , but our proposed methods are more widely applicable .
most approaches start by computing a two - sample t - statistic zj for each gene .
genes having t - statistics larger than a pre - dened cutoff ( in absolute value ) are declared signicant , and then the family - wise error rate or false discovery rate of the resulting gene list is assessed by comparing the tail area from a null distribution of the statistic .
this null distribution is derived from data permutations , or from
in an interesting and useful paper , subramanian et al .
( 123 ) proposed a method called gene set enrichment analysis ( gsea ) for assessing the signicance of pre - dened gene - sets , rather than individual genes .
the gene - sets can be derived from different sources , for example , the sets of genes representing biological pathways
received october 123; revised january 123
123supported in part by nsf grant dms - 123 - 123 and national institutes of health contract 123ro123
123supported in part by nsf grant dms - 123 - 123 and national institutes of health contract n123 -
key words and phrases .
multiple testing , gene set enrichment , hypothesis testing .
efron and r .
tibshirani
in the cell , or sets of genes whose dna sequences are close to together on the cells chromosomes .
the idea is that these gene - sets are closely related and , hence , will have similar expression patterns .
by borrowing strength across the gene - set , there is potential for increased statistical power .
in addition , in comparing study results on the same disease from different labs , one might get more reproducibility from gene - sets than from individual genes , because of biological and technical
the gsea methods works roughly as follows .
we begin with a pre - dened collection of gene - sets s123 , s123 , .
we compute t - statistic zj for all n genes in our data .
let zk = ( z123 , z123 , .
, zm ) be the gene scores for the m genes in gene - set sk .
in gsea we then compute a gene - set score sk ( zk ) for each gene - set sk , equal to essentially a signed version of the kolmogorovsmirnov statistic between the values ( zj , j sk ) and their complement ( zj , j / sk ) ; the sign taken positive or negative depending on the direction of shift .
the idea is that if some or all of the gene - set sk have higher ( or lower ) values of zj than expected , their summary score sk should be large .
an absolute cutoff value is dened , and values of sk above ( or below ) the cutoff are declared signicant .
the gsea method then does many permutations of the sample labels and recomputes the statistic on each permuted dataset .
this information is used to estimate the false discovery rate of the list of signicant gene - sets .
the bioconductor package limma offers an analysis option similar to gsea , but uses instead the simple average of the scores zk ( see smyth ( 123 ) ) , randomizing over the set of genes rather than the set of samples , what we call row randomization here .
other related ideas may be found in pavlidis et al .
( 123 ) and rahnenfhrer et al .
( 123 ) .
nobel and wright ( 123 ) propose the safe methodology a quite gen - eral permutation - based approach to the enrichment testing problem .
newton et al .
( 123 ) propose random set scoring methods for assessing the signicance of gene - set enrichment .
zahn et al .
( 123 ) propose an alternative to gsea that uses a van der waerden statistic in place of the kolmogorovsmirnov statistic and boot - strap sampling of the arrays instead of a permutation distribution .
other papers that address the problem of testing for differentially expressed sets of genes in - clude szabo et al .
( 123 ) , frisina et al .
( 123 ) , lu et al .
( 123 ) and dettling et al .
( 123 ) .
one of our goals here is to make explicit the choices involved between the various randomization schemes .
in studying the gsea work , we have found some shortcomings and ways it could be improved .
the gseas dependence on kolmogorovsmirnov statistics is a reasonable choice , but not a necessary one .
this paper puts the gsea proce - dure in a more theoretical framework that allows us to investigate questions of ef - ciency for gene - set inference; a new procedure based on the maxmean statistic is suggested that has superior power characteristics versus familiar location / scale
here are two simulated data examples that illustrate some of the main issues , and allow us to introduce our proposed solution .
we generated data on 123 genes
on testing the significance of sets of genes
example 123 : left panel shows histograms of gsea scores for original data ( black ) and from 123 permutations of the sample labels ( dashed ) .
the rst gene - set stands our fairly clearly with a score of about 123 .
the right panel shows the results using instead the maxmean statistic .
the rst gene - set stands out much more clearly than in the left panel .
and 123 samples , with each consecutive nonoverlapping block of 123 genes consid - ered to be a gene - set .
the rst 123 samples are the control group , and the second 123 samples are the treatment group .
first we generated each data value as i . i . d .
n ( 123 , 123 ) .
then the constant 123 was added to the rst 123 genes in the treatment group .
thus , half of the rst gene - set ( rst block of 123 genes ) has a higher aver - age expression in the treatment group , while all other gene - sets have no average difference in the two groups .
the left panel of figure 123 shows a histogram ( black lines ) of the gsea scores for the 123 gene - sets .
the rst gene - set clearly stands out , with a value of about 123 .
we did 123 permutations of the control - treatment labels , producing the dashed histogram in the top left panel of figure 123
the rst gene - set stands out on the right side of the histogram .
so the gsea method has performed reasonably well in this
in the paper we study alternative summary statistics for gene - sets .
our favorite is something we call the maxmean statistic : we compute the average of the pos - itive parts of each zi in s , and also the negative parts , and choose the one that is larger in absolute value .
the results for maxmean in this example are shown in the right panel of figure 123
the rst gene - set stands out more clearly than it does in the left panel .
in this paper we show by both analytic calculations and simulations that the maxmean statistics are generally more powerful than gsea .
now consider a different problem .
we generated data exactly as before , except that the rst 123 genes in every gene - set are 123 units higher in the treatment group .
the top left panel of figure 123 shows a histogram of the maxmean scores for the 123 gene - sets , and a histogram of the scores from 123 permutations of the sample
efron and r .
tibshirani
example 123 : top left panel shows a histogram of the maxmean scores .
in the top right panel a histogram of maxmean scores from 123 permutations of the sample labels has been added ( dashed ) : all of the gene - sets look to be signicant .
in the bottom left panel a histogram of the maxmean scores is shown along with maxmean scores from 123 row randomizationsgene - sets chosen from the full collection of genes at random ( dashed ) .
finally , in the bottom right panel , histograms of the restandardized scores from the original data ( solid ) and from 123 permutations of the sample labels ( dashed ) are shown .
( note that the horizontal axis has changed , since the values have been centered and scaled ) .
none of the gene - sets looks signicant , which is reasonable , given the way the data were
labels ( dashed ) .
all of the scores look signicantly large compared to the permu - tation values .
but given the way that the data were generated , there seems to be nothing special about any one gene - set .
to quantify this , we row randomized the 123 genes , leaving the sample labels as is .
the rst 123 genes in the scrambled set
on testing the significance of sets of genes
became the rst gene - set , the second 123 genes became the second gene - set , and so on .
we did this many 123 times , recomputing the maxmean statistic on each scrambled set .
the results are shown in the bottom left panel of figure 123
none of the original 123 gene - sets are notable when compared to gene - sets formed by randomly sampling from the full set of genes .
the point is that any method for assessing gene - sets should compare a given gene - set score not only to scores from permutations of the sample labels , but also take into account scores from sets formed by random selections of genes .
both gsea and safe do something like this , at least implicitly .
the bottom right panel of figure 123 puts all of these ideas together .
it uses the restandardized version of the maxmean statistic , in which we center and scale the maxmean statistic by its mean and standard deviation under the row random - izations , like those in the bottom left panel .
this standardized maxmean statistic is then computed both on the original data ( light histogram ) and on each of the permuted datasets ( dark histogram ) .
as we would expect , we see no signicant gene - sets .
this restandardization is potentially important for any gene summary statistic : it turns out that the gsea statistic incorporates a form of what we are
the two ideas illustrated abovealternative summary statistics for gene - sets and restandardization based on row randomizationare two of the main proposals in this paper .
in section 123 we describe the randomization and permutation meth - ods for estimating appropriate null distributions .
section 123 studies the choice of summary statistic for gene - sets , and introduces the maxmean statistic .
in section 123 we summarize our proposal for gene set analysis and discuss computational is - sues .
a simulation study is carried out in section 123 , comparing the power of the maxmean statistic to the gsea statistic and other competitors .
finally , in section 123 we give a number of examples of the method , including applications to a kidney cancer dataset , a generalization to the class prediction problem and comparison of different gene - set collections over the same expression dataset .
randomization and permutation .
a straightforward approach to gene - set analysis begins with some enrichment score s and computes its signicance .
here we argue that a second kind of by comparison with permutation values s comparison operation , row randomization , is also needed to avoid bias in the determination of signicance .
we begin with a simplied statement of the gene - set problem , leading later to a more realistic analysis .
let x indicate an n by n matrix of expression values , n genes and n microar - rays , with the rst n123 columns of x representing class 123 and the last n123 class 123 , n123+ n123 = n .
in the p123 example of subramanian et al .
( 123 ) there are n = 123 genes and n = 123 arrays relating to cell lines with normal or mutated states for the p123 factor , n123 = 123 normal and n123 = 123 mutated .
the ith row of x , that is , the data for gene i , yields a two - sample t - statistic ti comparing the classes .
in this section it will be convenient to transform the ti
efron and r .
tibshirani
theoretical null : zi n ( 123 , 123 ) ,
values to z - values zi , theoretically having a standard normal distribution , under the null hypothesis of no difference between the two treatments .
( the trans - formation is zi = 123 ( fn123 ( ti ) ) , where is the standard normal cumulative dis - tribution function ( c . d . f . ) while fn123 is the c . d . f .
for a t distribution having n 123 degrees of freedom . ) the methods here apply outside the realm of genes , microar - rays and t - tests , but that is the main application we have in mind .
to begin with , suppose that a single gene - set s , comprising m genes , is under consideration , and we wish to test the hypothesis that s is enriched , meaning that its m z - values are unusually large , positively or negatively , in a sense to be dened .
the scientic idea underlying enrichment , as nicely stated in subramanian et al .
( 123 ) , is that a biologically related set of genes , perhaps representing a genetic pathway , could reveal its importance through a general effect on its constituent z - values , whether or not the individual zis were signicantly nonzero .
let zs indicate the set of m z - values in s and s = s ( zs )
dene an enrichment test statistic , with larger value of s indicating greater enrich - ment .
the gsea algorithm uses a kolmogorovsmirnov type function for s ( zs ) .
a simpler approach starts with a function s of the individual z - values ,
si = s ( zi ) ,
and takes the gene - set score s to be the average of si in s ,
the choice s ( z ) = |z| will be discussed later .
limma ( smyth ( 123 ) ) , a microarray analysis program available in the bioconductor r package , implements ( 123 ) with s ( z ) = z , so s is simply zs , the average z - score in s ( actually using s = |zs| for two - sided inference ) .
section 123 develops a third choice , the maxmean statistic .
testing s for enrichment requires a null hypothesis distribution for s , and that is where difculties begin; there are two quite different models for what null might mean .
we discuss these next , in a spirit closely related to q123 and q123 of tian et al .
( 123 ) .
randomization model .
the null hypothesis hrand is that s has been chosen by random selection of m genes from the full set of n genes .
in this case the null density of s , say , grand ( s ) , can be obtained by row randomization : sets s of m rows of the expression matrix x are drawn at random , giving randomized versions s of ( 123 ) , a large number of which are generated and used to estimate grand ( s ) .
equivalently , random subsets z s of size m are drawn from all n zis , giving s = s ( z
on testing the significance of sets of genes
permutation model .
let xs be the m by n submatrix of x corresponding to s .
the null hypothesis hperm is that the n columns of xs are independent and identically distributed m - vectors ( i . i . d . ) .
the null density of s , gperm ( s ) , is ob - tained by column permutations , leading to an estimate of gperm ( s ) in the usual
the randomization model has the appealing feature of operating conditionally on the set z of all n z - values : given z , it tests the null hypothesis that the observed s is no bigger than what might be obtained by a random selection of s .
its defect concerns correlation between the genes .
suppose the scores si in ( 123 )
have empirical mean and standard deviation
s ( means , stdevs )
for the ensemble of all n genes .
because row randomization destroys gene - wide correlations , the randomized version of ( 123 ) will have mean and standard devia -
s ( , ) ,
and = stdevs /
however , will underestimate the variability of s if there is positive correlation among the z - values in s , which seems likely if s was chosen on the basis of bio - logical similarities .
the p - value in the limma package compares s = zs with the row randomization distribution of s , ignoring , perhaps dangerously , correlation
permutation methods deal nicely with the correlation problem .
let rs indicate the correlation matrix of the i . i . d .
columns of xs in the permutation model .
be - cause column - wise permutations maintain the integrity of column vectors , it turns out , under some regularity conditions , that z s , the permutation vector of z - values in s , will have correlation matrix approximating rs , as will zs itself .
in other words , for a prechosen gene - set s , the permutation correlation matrix of zs will be approximately correct .
figure 123 concerns correlation effects in the p123 example of subramanian et al .
( 123 ) ; the authors provide a catalog of 123 gene sets , of which 123 have m 123 members .
taking s ( z ) = z yields
as in ( 123 ) , this being the mean and standard deviation of all those zis involved
in the 123 gene - sets .
123 permutation values of s in s , were generated for each of the 123 gene - sets s , and the permutation standard
s , the average z
( means , stdevs ) = ( 123 , 123 ) ,
efron and r .
tibshirani
permutation standard deviation compared to randomization standard deviation for s = zs ,
123 gene - sets for p123 data , subramanian et al .
( 123 ) .
permutation values exceed randomization values , especially for gene - sets with large m at left , reecting positive correlations within gene - sets .
figure 123 plots
large m , with median 123 for m 123
ms , the randomization standard deviation
s has median 123 ( light line ) , but the ratio is considerably greater for
the permutation model has a serious weakness of its own : it does not take into account the overall statistics ( means , stdevs ) , ( 123 ) , as demonstrated next .
figure 123 concerns the brca data , efron ( 123 ) , a microarray experiment comparing two classes of breast cancer patients , n = 123 genes , n = 123 microarrays , n = 123 for class 123 , n123 = 123 for class 123
a two - sample t - statistic ti was computed for each gene and converted to z - value , zi = 123 ( f123 ( ti ) ) .
the n z - values have mean and
z ( 123 , 123 ) .
random selection from the n genes .
enrichment was tested with s = ( cid : 123 )
in this case ( 123 ) , the theoretical n ( 123 , 123 ) null , substantially underestimates the z - values variability , their histogram looking like an overdispersed but somewhat for this example 123 gene - sets s of size m = 123 each were constructed by that is , by using ( 123 ) and ( 123 ) with s ( z ) = |z| .
figure 123 shows that the permu - tation distribution s greatly underestimates the actual 123 s values .
a standard benjaminihochberg ( 123 ) fdr analysis based on permutation p - values , carried
on testing the significance of sets of genes
enrichment statistics s for 123 randomly selected gene - sets of size m = 123 , heavy line |zi| / m , brca data , histogram , lies far to right of permutation s hedenfalk et al .
( 123 ) .
restandardized values ( 123 ) , light line histogram , gives a much better match to actual values .
values , solid histogram .
s = ( cid : 123 )
out at rejection level q = 123 , labels 123 of the 123 generate as enriched , even though we know that all of them were constructed randomly .
it is easy to spot the trouble here : the permutation z - values are much less dis - persed than the actual zs , with marginal mean and standard deviation , for all n of
compared to ( 123 ) .
( this is a dependable feature of the permutation t - test , which n ( 123 , 123 ) , the theoretical null , under a wide variety of circum - tends to yield z
over all n genes and a large
i ) are correspondingly reduced .
letting ( mean
) indicate the mean and standard deviation of s
the individual scores s
number of permutations ,
) = ( 123 , 123 ) compared to ( means , stdevs ) = statistics that are
we computed ( mean ( 123 , 123 ) for the actual scores ( 123 ) .
this translates into s much smaller than the actual s values .
efron and r .
tibshirani
restandardization .
we combine the randomization and permutation ideas into a method that we call restandardization .
this can be thought of to take account of the overall as a method of correcting permutation values s s s ( zi ) / m as in
distribution of the individual scores si .
for a gene - set score s = ( cid : 123 )
( 123 ) and ( 123 ) , the restandardized permutation value is dened to be
= means + stdevs
with ( means , stdevs ) and ( mean tions dened at ( 123 ) and ( 123 ) .
) the overall means and standard devia -
a restandardized p - value for testing the enrichment of gene - set s is obtained by
comparing its actual enrichment score s to a large number b of s
ps = # ( s
values exceeding s ) / b .
figure 123 shows the restandardized value s
with the actual s values , though the s
giving much better agreement than distribution is moderately overdis -
here is another equivalent way to express the restandardization procedure : we rst standardize the statistic s with respect to its randomization mean and stan - dard deviation , and then compute the permutation distribution of the standardized statistic .
this gives the p - value
ps = #
it is this form of restandardization that we use in our software package gsa , de - scribed in section 123
restandardization can also be applied to more complicated gene - set statistics s ,
not simple averages as in ( 123 ) , via
here ( , ) are the mean and standard deviation of s for a randomly selected
) are the corresponding quantities gene - set of size m , as in ( 123 ) , while (
based on a permuted data matrix; computing ( ) requires a nested simulation .
the gsea enrichment test incorporates a form of restandardization : it com - pares the empirical c . d . f .
of the z - values in s with the c . d . f .
of all other z - values; the latter c . d . f .
brings to bear information from the overall distribution of z , much like means and stdevs do in ( 123 ) .
this same approach could be used in context ( 123 ) by replacing s ( zi ) in ( 123 ) with t ( zi ) = ( s ( zi ) means ) / stdevs , leading to
t ( zi ) / m = ( s means ) / stdevs
on testing the significance of sets of genes
as the enrichment statistic for s .
then ( 123 ) reduces to
ps = # ( t
> t ) / b ,
so that the restandardized p - value equals the usual permutation p - value .
restandardization can be shown to yield improved inferences in a variety of
if s was selected randomly , as in the randomization model .
if the theoretical null ( 123 ) , z n ( 123 , 123 ) , agrees with the empirical distribution of the n z - values .
if the zis are uncorrelated .
the method is not perfect , as examples can be constructed to show .
neither the randomization nor permutation models perfectly describe how gene - sets s come under consideration in the catalog examples of subramanian et al .
( 123 ) , making some sort of compromise formula a necessity .
efcient tests for enrichment .
the randomization and permutation models specify null hypotheses for the selection of a gene - set s .
notions of ef - cient testing , however , require us to specify alternatives to the null selection .
this section begins with an exponential family selection model , considers some spe - cic test statistics , and goes on to propose the maxmean statistic , which leads to enrichment tests with good power characteristics .
the poisson selection model starts with independent poisson variates
ind po ( i ) ,
for i = 123 , 123 , .
, n , where si = s ( zi ) , for s ( ) a given j - dimensional function , an unknown j - dimensional parameter vector ,
t = n ( cid : 123 )
s = ( i : ii = 123 ) ,
123 i an unknown scalar parameters .
in what follows , the i will be small and the ii almost all zeros or ones , mostly zeros .
for convenient exposition we assume that all the ii are zeros or ones , though this is not essential .
we dene the selected gene - set s as composed of those genes having ii = 123 ,
so s has
efron and r .
tibshirani
members .
it is easy to calculate the probability g , ( s ) of selecting my particular
g , ( s ) =
this is a product of two exponential family likelihoods , yielding maximum likeli -
hood estimates ( cid : 123 ) = m and ( cid : 123 )
si = ss .
g ( s|m ) = m ! em (
parameter = 123 corresponds to the randomization model null hypothesis that from its null expectation s = ( cid : 123 ) s has been selected at random .
given gene - set size m , the sufcient statistic for testing h123 : = 123 is ss , called s at ( 123 ) .
an efcient test rejects h123 if ss is far 123 si / n .
if ss is one - dimensional , as in section 123 , we reject for extreme values of ss , either positive or negative .
under h123 : = 123 , all gene - sets s of size m are equally likely .
nonzero tilts ( cid : 123 ) ss , as seen in ( 123 ) where
the selection toward gene - sets having larger values of
efcient choice of a gene - set enrichment test statistic s = zs depends on the individual scoring function si = s ( zi ) in ( 123 ) .
consider two choices : both of which are univariate and have a scalar , j = 123
the rst of these , the from z = ( cid : 123 ) limma choice , uses s = zs; enriched gene - sets s will tend to have zs far away 123 zi / n .
this is ne if enrichment manifests itself as a shift of location in z - values .
the second choice s ( 123 ) ( z ) = |z| has power against scale alternatives .
for general use one would like enrichment test statistics having power against both shift and scale alternatives .
to this end , dene the two - dimensional scoring
s ( 123 ) ( z ) = |z| ,
s ( 123 ) ( z ) = z
s ( + ) ( z ) = max ( z , 123 ) , s ( ) ( z ) = min ( z , 123 ) , s , s ( )
and the maxmean test statistic
smax = max
smax is designed to detect unusually large z - values in either or both directions .
note that smax is not the same as the largest absolute value of the mean of the pos - itive or negative z values in the gene - set : it divides by the total number of genes m .
on testing the significance of sets of genes
if , for example , a gene - set of 123 genes had 123 scores of 123 and one score of 123 , the average of the positive scores would be 123 , and the average of the negative scores equal to 123 , so the mean with largest absolute value would be 123
but the maxmean statistic is the maximum of 123 / 123 = 123 and 123 ( 123 ) / 123 = 123 , and the negative scores would win .
the maxmean statistic is robust by design , not allowing a few large positive or negative gene scores to dominate .
figure 123 compares the power of smax with the limma test that rejects the null hypothesis of no enrichment for large values of the absolute mean statistic |zs| .
here s consists of m = 123 independent normal z - values , contours of equal power are shown , for testing h123 : ( b , g ) = ( 123 , 123 ) versus alterna - tives ( b 123 , g 123 ) ( or , equivalently , ( b 123 , g 123 ) ) , at level 123; better power is reected by contours nearer the null hypothesis point ( b , g ) = ( 123 , 123 ) .
as expected , the absolute mean test has good power for shift alternatives b ( cid : 123 ) = 123 , but no power for scale alternatives g > 123 , as shown by its nearly vertical contour
i = 123 , 123 , .
, m = 123
ind n ( b , g123 ) ,
contours of equal power for absolute mean , enrichment statistic |zs| ( jagged vertical line ) mean of absolute value ( curving broken line ) , and maxmean statistic ( heavy curving lines ) ; for testing ind n ( 123 , 123 ) vs n ( b , g123 ) , i = 123 , 123 , .
, m = 123 , at level 123; ks is 123 power contour for the h123 : zi kolmogorovsmirnov test , dominated by maxmean test with 123 contour everywhere closer to null point ( 123 , 123 ) .
using mean absolute value , average over s of |z| has very little power versus shift alternatives , curved dashed line .
efron and r .
tibshirani
the maxmean test shows reasonable power in both directions .
comparing the 123 power contours , for instance , shows maxmean almost dominating |zs| .
also shown is ks , the 123 power contour for a test based on absolute kolmogorov smirnov distance between the empirical c . d . f .
of the 123 z - values and a n ( 123 , 123 ) c . d . f .
( the gsea test is based on an improved variant of the kolmogorovsmirnov statistic . ) in this case , maxmean dominates ks , its contour being everywhere closer to ( b , g ) = ( 123 , 123 ) .
finally , we show the results for the test based on the mean ab - solute value : this has the best power for pure scale alternatives but is not very sensitive to location shifts .
using a similar setup , the left panel of figure 123 compares the power of the maxmean statistic to that of the individual gene scores zi .
we see that the maxmean statistic has a strong power advantage .
in the right panel we have changed the setup slightly , with half of the genes in the gene - set generated as n ( b , g123 ) , and the other half as n ( b , g123 ) .
the increase in power enjoyed by the maxmean statistic is slightly less than in the left panel , but it is still substantial .
we applied the maxmean statistic to the p123 data with the catalog of 123 gene - sets in subramanian et al .
( 123 ) .
restandardization , ( 123 ) , noticeably improved results , though the effect was much less dramatic than in figure 123
applying the fdr algorithm to the restandardized p - value ( 123 ) , cutoff level q = 123 , yielded 123 signicant gene - sets , table 123 , in close agreement with table 123 of subramanian et al .
( 123 ) .
indicating positive enrichment in the mutant class , while the other six gene - sets had bigger z - values overall in the normal class .
signicance is dened in a two - sided testing sense here , but we can use s ( + ) in ( 123 ) separately .
gene - sets 123 and 123 in table 123 have s ( )
contours of power 123 ( solid lines ) for individual gene scores zi and power ind n ( 123 , 123 ) vs 123 , 123 .
123 ( broken lines ) n ( b , g123 ) , i = 123 , 123 , .
, m = 123
in the left panel , all genes in the gene - set are shifted by b; in the right panel , half of the genes are shifted by b and half by b .
for the maxmean statistic;
for testing h123 : zi
on testing the significance of sets of genes
signicant gene - sets , fdr cutoff 123 , for p123 data , subramanian
( 123 ) ; maxmean statistic restandardized
p123 hypoxia
p123 pathway
indicate signicant gene - sets listed in subramanian et al .
( 123 ) , table 123
they list the n . g . f .
pathway as almost signicant .
p123 up 123
sa g123 and s phases
restandardization formula ( 123 ) was applied separately to s ( + ) in ( 123 ) , and then combined to give
figure 123 displays the top eight pathways , showing the individual gene scores zi in each pathway .
the inset at the top shows the estimated fdr for an individual gene analysis .
we see that the cutoff for an fdr of 123 is about 123 for neg - ative scores , while the fdr for positive scores never gets down to 123 .
hence , an analysis of individual genes would report as signicant the top few genes in the negative gene - sets , and none of the genes in the positive gene - sets .
note that location shift alternatives look quite reasonable here .
the values of ( means , stdevs ) and ( mean
) used in ( 123 ) were based on the catalog of 123 , 123 genes listed ( with multiple occurrences ) in the 123 gene - sets , rather than the 123 , 123 genes in the original p123 data set .
table 123 shows consid - erable differences between the two choices for ( means , stdevs ) , though not for ( z ) being similar .
when a catalog of gene - sets s is simultaneously under consideration for enrichment , the catalog choice of ( means , stdevs ) is preferable from the row randomization view -
) , with s = s ( + ) ( z ) , the comparison for s
the poisson selection model ( 123 ) and ( 123 ) follows the randomization model of section 123 in that the set z of n original z - values is treated as a xed ancil - lary , with only the selection process for s considered random .
we could , instead , think of z - values selected for inclusion in s as coming from a different underlying distribution , for example ,
f ( z ) = e
s ( z ) log t f123 ( z ) ,
in ( 123 ) , and t = ( cid : 123 ) is based on ss = ( cid : 123 )
where f123 ( z ) is the baseline density for nonenriched z - values , and s ( z ) are as s ( z ) f123 ( z ) dz .
if the members of s are selected indepen - dently according to ( 123 ) , then the most powerful test for null hypothesis = 123
s s ( z ) / m , just as in ( 123 ) .
efron and r .
tibshirani
p123 data : the top eight pathways showing the individual gene scores zi in each pathway .
the inset at the top shows the estimated fdr for an individual gene analysis .
comparison of ( mean , stdev ) values for s = s ( + ) ( z ) , ( 123 ) ; for original list of 123 , 123 genes in p123 data , versus 123 , 123 genes listed with multiple occurrences , in catalog of 123 gene - sets .
latter is
preferred choice for restandardization formula ( 123 )
original 123 , 123 genes catalog 123 , 123 genes
on testing the significance of sets of genes
this point of view is more congenial to the permutation model of section 123 , but f123 denote the empirical
there is really not much practical difference from ( 123 ) .
let ( cid : 123 )
f123 ( a , b ) = # ( zi in ( a , b ) ) / b , f ( a , b ) = ( cid : 123 ) ( i for zi in ( a , b ) )
then ( 123 ) and ( 123 ) give ( cid : 123 )
f the tilted distribution
f ( a , b ) =
just as in ( 123 ) .
more elaborate probability models can be constructed to make , say ,
kolmogorovsmirnov distance the optimal test statistic .
the strongpoint of the maxmean enrichment statistic is its good performance against simple location and scale alternatives , as seen in figure 123
computational issues and software .
the developments in the previous two sections lead to our gene set analysis procedure , which we summarize here :
compute a summary statistic zi for each gene , for example , the two - sample t - statistic for two - class data .
let zs be the vector of zi values for genes in a 123
for each gene - set s , choose a summary statistic s = s ( z ) : choices include the average of zi or |zi| for genes in s , the gsea statistic or , our recommended choice , the maxmean statistic ( 123 ) .
standardize s by its randomization mean and standard deviation as in ( 123 ) : ( cid : 123 ) = ( s means ) / stdevs .
for summary statistics such as the mean , mean ab - solute value or maxmean ( but not gsea ) , this can be computed from the ge - newise means and standard deviations , without having to draw random sets of genes .
note formula ( 123 ) for the maxmean statistic .
compute permutations of the outcome values ( e . g . , the class labels in the two - on each permuted dataset , yielding permutation
class case ) and recompute s
( cid : 123 ) 123 ,
we use these permutation values to estimate p - values for each gene - set score s and false discovery rates applied to these p - values for the collection of gene - set
it would be convenient computationally to pool the permutation values for dif - ferent gene - sets : this is often done in the analysis of individual genes ( e . g . , in the sam package tusher et al .
( 123 ) ) and also in the gsea software .
such pooling
efron and r .
tibshirani
reduces the number of permutations needed to obtain sufcient accurate results .
however , we have found that in gene - set analysis the permutation distribution for each gene - set depends heavily on both the number of genes in the gene - set and their average pairwise correlation ( neither of which applies to individual - gene analysis ) .
hence , we do not pool the permutation values , and so we must carry out at least 123 permutations to get accurate results .
however , with a careful imple - mentation this need not be an obstacle for practical use .
we have written an r language package gsa ( gene - set analysis ) for carry - ing out these computations .
this will be freely available along with collections of gene - sets for use with the package .
simulation comparison of different gene - set summaries .
in this study we simulated 123 genes and 123 samples in each of 123 classes , control and treat - ment .
the genes were assigned to with 123 gene - sets , each with 123 genes .
all mea - surements were generated as n ( 123 , 123 ) before the treatment effect was added .
there were ve different scenarios :
all 123 genes of gene - set 123 are 123 units higher in class 123 , 123
the 123st 123 genes of gene - set 123 are 123 units higher in class 123 , 123
the 123st 123 genes of gene - set 123 are 123 units higher in class 123 , 123
the 123st 123 genes are 123 units higher in class 123 , 123
the 123st 123 genes of gene - set 123 are 123 units higher in class 123 , and 123nd 123 genes
of gene - set 123 are 123 units lower in class 123
123 ) , with small values being good .
here s
in every one of these scenarios only the rst gene - set is of potential interest .
for each scenario , we carried out 123 permutations and report the estimated tail proba - is the restandardized version of a summary statistic , and the quantity prob ( s 123 ) is the observed p - value for the rst gene - set .
we compared ve different summary statistics : the mean of zi , the mean of |zi| , maxmean , gsea and gsea applied to |zi| .
everything was repeated 123 times , and the mean and standard error of the tail probability over the 123 simulations are reported in table 123
while the maxmean can be beaten by a small margin by the mean or the mean of the absolute values in the one - sided or two - sided scenarios , respectively , it is the only method with consistently low p - values in all
survival with kidney cancer .
in this example we apply the gene - set methodology to a dataset with censored survival outcome .
zhao et al .
( 123 ) col - lected gene expression data on 123 , 123 genes from 123 kidney patients .
survival times were also measured for each patient .
the data were split into 123 samples to form the training set and the remaining 123 formed the test set .
on testing the significance of sets of genes
results of simulation study : p - values for the rst gene - set , for ve different summary statistics ( columns ) and ve different scenarios ( rows , described in the text ) .
the rst four scenarios are one - sided shifts , while the last one is two - sided .
we see that the maxmean statistic is the only one
with consistently low p - values in all ve scenarios
k and st e
we computed the cox partial likelihood score statistic zi for each gene , and used this as the basis for gene - set analysis using the maxmean statistics sk .
since there are separate training and test sets , we examined the concordance between the scores sk for a given gene - set between the training and test sets .
denote the train - ing and test set scores by st r k .
we measured the concordance by setting a cutpoint c and dening a test set value with |st e | > c to be a true positive; other - wise it is called a true negative .
then we applied the same cutpoint to the training set scores st r k and then computed the false positive and false negative rates .
we ap - plied this same idea both to scores for the individual genes and also to gene - set enrichment analysis , based on the cox scores .
the cutpoint c was varied to gen - erate the curves of false positive and false negative rates in figure 123
we see that both the maxmean statistic and gsea statistics have considerably lower false pos - itive rates , for a given false negative rate , than the individual gene analysis .
the maxmean statistic also enjoys an advantage over gsea , which is not surprising given the results from our power studies .
in this case it seems that a list of signif - icant gene - sets based on the maxmean statistic will tend to be more reproducible than a list of signicant genes from an individual gene analysis .
comparisons of different gene - set collections .
the gene - sets used in the examples of this paper are the collection of 123 gene pathways developed by
efron and r .
tibshirani
kidney cancer microarray data : false positive and false negative rates for three methods , using the test set values for each method to dene the true positive and true negative for genes
subramanian et al .
( 123 ) .
this is the c123 functional collection in their mole - cular signature database .
the same authors provide three additional collections : c123 ( chromosomal location , 123 sets ) , c123 ( motif - based , 123 sets ) and c123 ( chro - mosomal location , 123 sets ) .
the stanford microarray database has at least two more collections in their synethetic gene database that are potentially useful for this purpose : tissue types ( 123 sets ) and cellular processes ( 123 sets ) .
we applied our gene - set analysis technique using the maxmean statistic to both the p123 and kid - ney cancer datasets , using each of these six collections of gene - sets .
the results are shown in figure 123
in both cases the fdr results in the left tail are shown for gene - sets with negative maxmean statistics .
the fdrs for the right tail were high for both datasets .
we see that different collections exhibit the lowest fdrs in the two studies : motif , chromosomes and pathways for the p123 data and correlation
on testing the significance of sets of genes
gene set analysis applied to the p123 mutation data and kidney cancer data , comparing the estimated fdrs over six different collections of gene - sets .
in both cases the fdr results in the left tail ( negative gene - set scores ) are shown .
the fdrs for the right tail ( positive gene - set scores ) were high for both datasets .
for the kidney cancer data .
this suggests that , for a given expression dataset , sys - tematic mining of different gene - set collections could be a useful exercise for discovering potentially interested gene - sets for further investigation .
efron and r .
tibshirani
acknowledgments .
we would like to thank the authors of gsea for their assistance , especially pablo tamayo for considerable efforts in debugging our im - plementation of the gsea procedure .
we would also like to thank trevor hastie and rafael irizarry for helpful comments and suggestions .
finally , we would like to thank the associate editor and two referees for helpful comments that led to improvements in this paper .
