an introduction to variational methods for graphical models
michael i .
jordan department of electrical engineering and computer sciences and department of statistics , university of california , berkeley , ca 123 , usa
gatsby computational neuroscience unit , university college london wc123n 123ar , uk
tommi s .
jaakkola articial intelligence laboratory , mit , cambridge , ma 123 , usa
lawrence k .
saul at&t labsresearch , florham park , nj 123 , usa
editor : david heckerman
abstract .
this paper presents a tutorial introduction to the use of variational methods for inference and learning in graphical models ( bayesian networks and markov random elds ) .
we present a number of examples of graphical models , including the qmr - dt database , the sigmoid belief network , the boltzmann machine , and several variants of hidden markov models , in which it is infeasible to run exact inference algorithms .
we then introduce variational methods , which exploit laws of large numbers to transform the original graphical model into a simplied graphical model in which inference is efcient .
inference in the simpied model provides bounds on probabilities of interest in the original model .
we describe a general framework for generating variational transformations based on convex duality .
finally we return to the examples and demonstrate how variational algorithms can be formulated in each
keywords : graphical models , bayesian networks , belief networks , probabilistic inference , approximate infer - ence , variational methods , mean eld methods , hidden markov models , boltzmann machines , neural networks
the problem of probabilistic inference in graphical models is the problem of computing a conditional probability distribution over the values of some of the nodes ( the hidden or unobserved nodes ) , given the values of other nodes ( the evidence or observed nodes ) .
thus , letting h represent the set of hidden nodes and letting e represent the set of evidence nodes , we wish to calculate p . h j e / :
p . h j e / d p . h; e /
jordan et al .
general exact inference algorithms have been developed to perform this calculation ( jensen , 123; shachter , andersen , & szolovits , 123; shenoy , 123 ) ; these algorithms take system - atic advantage of the conditional independencies present in the joint distribution as inferred from the pattern of missing edges in the graph .
we often also wish to calculate marginal probabilities in graphical models , in particular the probability of the observed evidence , p . e / .
viewed as a function of the parameters of the graphical model , for xed e , p . e / is an important quantity known as the likelihood .
as is suggested by eq .
( 123 ) , the evaluation of the likelihood is closely related to the calculation of p . h j e / .
indeed , although inference algorithms do not simply compute the numerator and denominator of eq .
( 123 ) and divide , they in fact generally produce the likelihood as a by - product of the calculation of p . h j e / .
moreover , algorithms that maximize likelihood ( and related quantities ) generally make use of the calculation of p . h j e / as a subroutine .
although there are many cases in which the exact algorithms provide a satisfactory solution to inference and learning problems , there are other cases , several of which we discuss in this paper , in which the time or space complexity of the exact calculation is unacceptable and it is necessary to have recourse to approximation procedures .
within the context of the junction tree construction , for example , the time complexity is exponential in the size of the maximal clique in the junction tree .
as we will see , there are natural architectural assumptions that necessarily lead to large cliques .
even in cases in which the complexity of the exact algorithms is manageable , there can be reason to consider approximation procedures .
note in particular that the exact algorithms make no use of the numerical representation of the joint probability distribution associ - ated with a graphical model; put another way , the algorithms have the same complexity regardless of the particular probability distribution under consideration within the family of distributions that is consistent with the conditional independencies implied by the graph .
there may be situations in which nodes or clusters of nodes are nearly conditionally independent , situations in which node probabilities are well determined by a subset of the neighbors of the node , or situations in which small subsets of congurations of variables contain most of the probability mass .
in such cases the exactitude achieved by an exact algorithm may not be worth the computational cost .
a variety of approximation proce - dures have been developed that attempt to identify and exploit such situations .
examples include the pruning algorithms of kjrulff ( 123 ) , the bounded conditioning method of horvitz , suermondt , and cooper ( 123 ) , search - based methods ( e . g . , henrion , 123 ) , and the localized partial evaluation method of draper and hanks ( 123 ) .
a virtue of all of these methods is that they are closely tied to the exact methods and thus are able to take full advantage of conditional independencies .
this virtue can also be a vice , however , given the exponential growth in complexity of the exact algorithms .
a related approach to approximate inference has arisen in applications of graphical model inference to error - control decoding ( mceliece , mackay , & cheng , 123 ) .
in particular , kim and pearls algorithm for singly - connected graphical models ( pearl , 123 ) has been used successfully as an iterative approximate method for inference in non - singly - connected
another approach to the design of approximation algorithms involves making use of monte carlo methods .
a variety of monte carlo algorithms have been developed ( see neal ,
introduction to variational methods
123 ) and applied to the inference problem in graphical models ( dagum & luby , 123; fung & favero , 123; gilks , thomas , & spiegelhalter , 123; jensen , kong , & kjrulff , 123; pearl , 123 ) .
advantages of these algorithms include their simplicity of implementation and theoretical guarantees of convergence .
the disadvantages of the monte carlo approach are that the algorithms can be slow to converge and it can be hard to diagnose their convergence .
in this paper we discuss variational methods , which provide yet another approach to the design of approximate inference algorithms .
variational methodology yields deterministic approximation procedures that generally provide bounds on probabilities of interest .
the basic intuition underlying variational methods is that complex graphs can be probabilisti - cally simple; in particular , in graphs with dense connectivity there are averaging phenomena that can come into play , rendering nodes relatively insensitive to particular settings of val - ues of their neighbors .
taking advantage of these averaging phenomena can lead to simple , accurate approximation procedures .
it is important to emphasize that the various approaches to inference that we have outlined are by no means mutually exclusive; indeed they exploit complementary features of the graphical model formalism .
the best solution to any given problem may well involve an algorithm that combines aspects of the different methods .
in this vein , we will present variational methods in a way that emphasizes their links to exact methods .
indeed , as we will see , exact methods often appear as subroutines within an overall variational approximation ( cf .
jaakkola & jordan , 123; saul & jordan , 123 ) .
it should be acknowledged at the outset that there is as much art as there is science in our current understanding of how variational methods can be applied to probabilistic inference .
variational transformations form a large , open - ended class of approximations , and although there is a general mathematical picture of how these transformations can be exploited to yield bounds on probabilities in graphical models , there is not as yet a systematic algebra that allows particular variational transformations to be matched optimally to particular graphical models .
we will provide illustrative examples of general families of graphical models to which variational methods have been applied successfully , and we will provide a general mathematical framework which encompasses all of these particular examples , but we are not as yet able to provide assurance that the framework will transfer easily to other examples .
we begin in section 123 with a brief overview of exact inference in graphical models , basing the discussion on the junction tree algorithm .
section 123 presents several examples of graphical models , both to provide motivation for variational methodology and to provide examples that we return to and develop in detail as we proceed through the paper .
the core material on variational approximation is presented in section 123
sections 123 and 123 ll in some of the details , focusing on sequential methods and block methods , respectively .
in these latter two sections , we also return to the examples and work out variational approximations in each case .
finally , section 123 presents conclusions and directions for future research .
exact inference
in this section we provide a brief overview of exact inference for graphical models , as repre - sented by the junction tree algorithm ( for relationships between the junction tree algorithm
jordan et al .
figure 123
a directed graph is parameterized by associating a local conditional probability with each node .
the joint probability is the product of the local probabilities .
and other exact inference algorithms , see shachter , andersen , and szolovits ( 123 ) ; see also dechter ( 123 ) , and shenoy ( 123 ) , for recent developments in exact inference ) .
our intention here is not to provide a complete description of the junction tree algorithm , but rather to introduce the moralization and triangulation steps of the algorithm .
an un - derstanding of these steps , which create data structures that determine the run time of the inference algorithm , will sufce for our purposes . 123 for a comprehensive introduction to the junction tree algorithm see jensen ( 123 ) .
graphical models come in two basic avorsdirected graphical models and undirected graphical models .
a directed graphical model ( also known as a bayesian network ) is specied numerically by associating local conditional probabilities with each of the nodes in an acyclic directed graph .
these conditional probabilities specify the probability of node si given the values of its parents , i . e . , p . si j s . i / / , where . i / represents the set of indices of the parents of node si and s . i / represents the corresponding set of parent nodes ( see gure 123 ) . 123 to obtain the joint probability distribution for all of the n nodes in the graph , i . e . , p . s / d p . s123; s123; : : : ; sn / , we take the product over the local node probabilities :
p . s / d ny
si j s . i /
inference involves the calculation of conditional probabilities under this joint distribution .
an undirected graphical model ( also known as a markov random eld ) is specied numerically by associating potentials with the cliques of the graph . 123 a potential is a function on the set of congurations of a clique ( that is , a setting of values for all of the nodes in the clique ) that associates a positive real number with each conguration .
thus , for every subset of nodes ci that forms a clique , we have an associated potential `i . ci / ( see gure 123 ) .
the joint probability distribution for all of the nodes in the graph is obtained by taking the product over the clique potentials :
`i . ci /
introduction to variational methods
figure 123
an undirected graph is parameterized by associating a potential with each clique in the graph .
the cliques in this example are c123 d fs123; s123; s123g , c123 d fs123; s123; s123g , and c123 d fs123; s123; s123g .
a potential assigns a positive real number to each conguration of the corresponding clique .
the joint probability is the normalized product of the clique potentials .
where m is the total number of cliques and where the normalization factor z is obtained by summing the numerator over all congurations :
`i . ci /
in keeping with statistical mechanical terminology we will refer to this sum as a partition
the junction tree algorithm compiles directed graphical models into undirected graphical models; subsequent inferential calculation is carried out in the undirected formalism .
the step that converts the directed graph into an undirected graph is called moralization .
( if the initial graph is already undirected , then we simply skip the moralization step ) .
to understand moralization , we note that in both the directed and the undirected cases , the joint probability distribution is obtained as a product of local functions .
in the directed case , these functions are the node conditional probabilities p . si j s . i / / .
in fact , this probability nearly qualies as a potential function; it is certainly a real - valued function on the congurations of the set of variables fsi ; s . i / g .
the problem is that these variables do not always appear together within a clique .
that is , the parents of a common child are not necessarily linked .
to be able to utilize node conditional probabilities as potential functions , we marry the parents of all of the nodes with undirected edges .
moreover we drop the arrows on the other edges in the graph .
the result is a moral graph , which can be used to represent the probability distribution on the original directed graph within the undirected formalism . 123
the second phase of the junction tree algorithm is somewhat more complex .
this phase , known as triangulation , takes a moral graph as input and produces as output an undirected graph in which additional edges have ( possibly ) been added .
this latter graph has a special
jordan et al .
between nodes b and d renders the graph triangulated .
( a ) the simplest non - triangulated graph .
the graph has a 123 - cycle without a chord .
( b ) adding a chord
property that allows recursive calculation of probabilities to take place .
in particular , in a triangulated graph , it is possible to build up a joint distribution by proceeding sequentially through the graph , conditioning blocks of interconnected nodes only on predecessor blocks in the sequence .
the simplest graph in which this is not possible is the 123 - cycle , the cycle of four nodes shown in gure 123 ( a ) .
if we try to write the joint probability sequentially as , for example , p . a / p . b j a / p . c j b / p . d j c / , we see that we have a problem .
in particular , a depends on d , and we are unable to write the joint probability as a sequence of conditionals .
a graph is not triangulated if there are 123 - cycles which do not have a chord , where a chord is an edge between non - neighboring nodes .
thus the graph in gure 123 ( a ) is not triangulated; it can be triangulated by adding a chord as in gure 123 ( b ) .
in the latter graph we can write the joint probability sequentially as p . a; b; c; d / d p . a / p . b; d j a / p . c j b; d / .
more generally , once a graph has been triangulated it is possible to arrange the cliques of the graph into a data structure known as a junction tree .
a junction tree has the running intersection property : if a node appears in any two cliques in the tree , it appears in all cliques that lie on the path between the two cliques .
this property has the important consequence that a general algorithm for probabilistic inference can be based on achieving local consistency between cliques .
( that is , the cliques assign the same marginal probability to the nodes that they have in common ) .
in a junction tree , because of the running intersection property , local consistency implies global consistency .
the probabilistic calculations that are performed on the junction tree involve marginal - izing and rescaling the clique potentials so as to achieve local consistency between neigh - boring cliques .
the time complexity of performing this calculation depends on the size of the cliques; in particular for discrete data the number of values required to represent the potential is exponential in the number of nodes in the clique .
for efcient inference , it is therefore critical to obtain small cliques .
in the remainder of this paper , we will investigate specic graphical models and consider the computational costs of exact inference for these models .
in all of these cases we will either be able to display the obvious triangulation , or we will be able to lower bound the size of cliques in a triangulated graph by considering the cliques in the moral graph .
introduction to variational methods
thus we will not need to consider specic algorithms for triangulation ( for discussion of triangulation algorithms , see , e . g . , kjrulff , 123 ) .
in this section we present examples of graphical models in which exact inference is generally infeasible .
our rst example involves a diagnostic system in which a xed graphical model is used to answer queries .
the remaining examples involve estimation problems in which a graphical model is t to data and subsequently used for prediction or diagnosis .
the qmr - dt database
the qmr - dt database is a large - scale probabilistic database that is intended to be used as a diagnostic aid in the domain of internal medicine . 123 we provide a brief overview of the qmr - dt database here; for further details see shwe et al .
( 123 ) .
the qmr - dt database is a bipartite graphical model in which the upper layer of nodes represent diseases and the lower layer of nodes represent symptoms ( see gure 123 ) .
there are approximately 123 disease nodes and 123 symptom nodes in the database .
the evidence is a set of observed symptoms; henceforth we refer to observed symptoms as ndings and represent the vector of ndings with the symbol f .
the symbol d denotes the vector of diseases .
all nodes are binary , thus the components fi and di are binary random variables .
making use of the conditional independencies implied by the bipartite form of the graph , 123 and marginalizing over the unobserved symptom nodes , we obtain the following joint probability over diseases and ndings :
f; d / d p .
f j d / p . d / p .
fi j d /
p . d j /
figure 123
the structure of the qmr - dt graphical model .
the shaded nodes represent evidence nodes and are referred to as ndings .
jordan et al .
the prior probabilities of the diseases , p . d j / , were obtained by shwe et al .
from archival data .
the conditional probabilities of the ndings given the diseases , p .
fi j d / , were ob - tained from expert assessments under a noisy - or model .
that is , the conditional proba - bility that the ith symptom is absent , p .
fi d 123j d / , is expressed as follows :
fi d 123 j d / d . 123 qi123 /
. 123 qi j / d j
where the qi j are parameters obtained from the expert assessments .
considering the case in which all diseases are absent , we see that the qi123 parameter can be interpreted as the probability that the ith nding is present even though no disease is present .
the effect of each additional disease , if present , is to contribute an additional factor of . 123 qi j / to the probability that the ith nding is absent .
we will nd it useful to rewrite the noisy - or model in an exponential form :
fi d 123 j d / d exp
( cid : 123 ) i j d j ( cid : 123 ) i123
where ( cid : 123 ) i j ln . 123 qi j / are the transformed parameters .
note also that the probability of a positive nding is given as follows :
fi d 123 j d / d 123 exp
( cid : 123 ) i j d j ( cid : 123 ) i123
these forms express the noisy - or model as a generalized linear model .
if we now form the joint probability distribution by taking products of the local proba - bilities p .
fi j d / as in eq .
( 123 ) , we see that negative ndings are benign with respect to the inference problem .
in particular , a product of exponential factors that are linear in the diseases ( cf .
( 123 ) ) yields a joint probability that is also the exponential of an expression linear in the diseases .
that is , each negative nding can be incorporated into the joint probability in a linear number of operations .
products of the probabilities of positive ndings , on the other hand , yield cross products terms that are problematic for exact inference .
these cross product terms couple the diseases ( they are responsible for the explaining away phenomena that arise for the noisy - or model; see pearl , 123 ) .
unfortunately , these coupling terms can lead to an exponential growth in inferential complexity .
considering a set of standard diagnostic cases ( the cpc cases; see shwe et al . , 123 ) , jaakkola and jordan ( 123b ) found that the median size of the maximal clique of the moralized qmr - dt graph is 123 nodes .
thus even without considering the triangulation step , we see that diagnostic calculation under the qmr - dt model is generally infeasible . 123
introduction to variational methods
figure 123
the layered graphical structure of a neural network .
the input nodes and output nodes comprise the set of evidence nodes .
neural networks as graphical models
neural networks are layered graphs endowed with a nonlinear activation function at each node ( see gure 123 ) .
let us consider activation functions that are bounded between zero and one , such as those obtained from the logistic function f . z / d 123= . 123 c e z / .
we can treat such a neural network as a graphical model by associating a binary variable si with each node and interpreting the activation of the node as the probability that the associated binary variable takes one of its two values .
for example , using the logistic function , we write :
si d 123
123 c exp
j123i / ( cid : 123 ) i j s j ( cid : 123 ) i123
where ( cid : 123 ) i j are the parameters associated with edges between parent nodes j and node i , and ( cid : 123 ) i123 is the bias parameter associated with node i .
this is the sigmoid belief network introduced by neal ( 123 ) .
the advantages of treating a neural network in this manner include the ability to perform diagnostic calculations , to handle missing data , and to treat unsupervised learning on the same footing as supervised learning .
realizing these benets , however , requires that the inference problem be solved in an efcient way .
in fact , it is easy to see that exact inference is infeasible in general layered neural network models .
a node in a neural network generally has as parents all of the nodes in the preceding layer .
thus the moralized neural network graph has links between all of the nodes in this layer ( see gure 123 ) .
that these links are necessary for exact inference in general is clearin particular , during training of a neural network the output nodes are evidence nodes , thus the hidden units in the penultimate layer become probabilistically dependent , as do their ancestors in the preceding hidden layers .
thus if there are n hidden units in a particular hidden layer , the time complexity of inference is at least o . 123n / , ignoring the additional growth in clique size due to triangulation .
given that neural networks with dozens or even hundreds of hidden units are commonplace , we see that training a neural network using exact inference is not generally feasible .
jordan et al .
figure 123
moralization of a neural network .
the output nodes are evidence nodes during training .
this creates probabilistic dependencies between the hidden nodes which are captured by the edges added by the moralization .
figure 123
a boltzmann machine .
an edge between nodes si and s j is associated with a factor exp . ( cid : 123 ) i j si s j / that contributes multiplicatively to the potential of one of the cliques containing the edge .
each node also contributes a factor exp . ( cid : 123 ) i123 si / to one and only one potential .
boltzmann machines
a boltzmann machine is an undirected graphical model with binary - valued nodes and a restricted set of potential functions ( see gure 123 ) .
in particular , the clique potentials are formed by taking products of boltzmann factorsexponentials of terms that are at most quadratic in the si ( hinton & sejnowski , 123 ) .
thus each clique potential is a product of factors expf ( cid : 123 ) i j si s jg and factors expf ( cid : 123 ) i123sig , where si 123 f123; 123g . 123 a given pair of nodes si and s j can appear in multiple , overlapping cliques .
for each such pair we assume that the expression expf ( cid : 123 ) i j si s jg appears as a factor in one and only one clique potential .
similarly , the factors expf ( cid : 123 ) i123sig are assumed to appear in one and only one clique potential .
taking the product over all such clique potentials ( cf .
( 123 ) ) , we
p . s / d exp
( cid : 123 ) i j si s j cp
introduction to variational methods
where we have set ( cid : 123 ) i j d 123 for nodes si and s j that are not neighbors in the graphthis convention allows us to sum indiscriminately over all pairs si and s j and still respect the clique boundaries .
we refer to the negative of the exponent in eq .
( 123 ) as the energy .
with this denition the joint probability in eq .
( 123 ) has the general form of a boltzmann
saul and jordan ( 123 ) pointed out that exact inference for certain special cases of boltzmann machinesuch as trees , chains , and pairs of coupled chainsis tractable and they proposed a decimation algorithm for this purpose .
for more general boltzmann machines , however , decimation is not immune to the exponential time complexity that plagues other exact methods .
indeed , despite the fact that the boltzmann machine is a special class of undirected graphical model , it is a special class only by virtue of its param - eterization , not by virtue of its conditional independence structure .
thus , exact algorithms such as decimation and the junction tree algorithm , which are based solely on the graphical structure of the boltzmann machine , are no more efcient for boltzmann machines than they are for general graphical models .
in particular , when we triangulate generic boltzmann machines , including the layered boltzmann machines and grid - like boltzmann machines , we obtain intractably large cliques .
sampling algorithms have traditionally been used to attempt to cope with the intractabil - ity of the boltzmann machine ( hinton & sejnowski , 123 ) .
the sampling algorithms are overly slow , however , and more recent work has considered the faster mean eld ap - proximation ( peterson & anderson , 123 ) .
we will describe the mean eld approximation for boltzmann machines later in the paperit is a special form of the variational ap - proximation approach that provides lower bounds on marginal probabilities .
we will also discuss a more general variational algorithm that provides upper and lower bounds on probabilities ( marginals and conditionals ) for boltzmann machines ( jaakkola & jordan ,
hidden markov models
in this section , we briey review hidden markov models .
the hidden markov model ( hmm ) is an example of a graphical model in which exact inference is tractable; our purpose in discussing hmms here is to lay the groundwork for the discussion of intractable variations on hmms in the following sections .
see smyth , heckerman , and jordan ( 123 ) for a fuller discussion of the hmm as a graphical model .
an hmm is a graphical model in the form of a chain ( see gure 123 ) .
consider a sequence of multinomial state nodes xi and assume that the conditional probability of node xi , given its immediate predecessor xi123 , is independent of all other preceding variables .
( the index i can be thought of as a time index ) .
the chain is assumed to be homogeneous; that is , the matrix of transition probabilities , a d p . xi j xi123 / , is invariant across time .
we also require a probability distribution d p . x123 / for the initial state x123
the hmm model also involves a set of output nodes yi and an emission probability law b d p . yi j xi / , again assumed time - invariant .
jordan et al .
figure 123
a hmm represented as a graphical model .
the left - to - right spatial dimension represents time .
the output nodes yi are evidence nodes during the training process and the state nodes xi are hidden .
an hmm is trained by treating the output nodes as evidence nodes and the state nodes as hidden nodes .
an expectation - maximization ( em ) algorithm ( baum et al . , 123; dempster , laird , & rubin , 123 ) is generally used to update the parameters a; b; ; this algorithm involves a simple iterative procedure having two alternating steps : ( 123 ) run an inference algorithm to calculate the conditional probabilities p . xi jfyig / and p . xi ; xi123 jfyig / ; ( 123 ) update the parameters via weighted maximum likelihood where the weights are given by the conditional probabilities calculated in step ( 123 ) .
it is easy to see that exact inference is tractable for hmms .
the moralization and trian - gulation steps are vacuous for the hmm; thus the time complexity can be read off from gure 123 directly .
we see that the maximal clique is of size n 123 , where n is the dimensionality of a state node .
inference therefore scales as o . n 123t / , where t is the length of the time
factorial hidden markov models
in many problem domains it is natural to make additional structural assumptions about the state space and the transition probabilities that are not available within the simple hmm framework .
a number of structured variations on hmms have been considered in recent years ( see smyth et al . , 123 ) ; generically these variations can be viewed as dynamic belief networks ( dean & kanazawa , 123; kanazawa , koller , & russell , 123 ) .
here we consider a particularly simple variation on the hmm theme known as the factorial hidden markov model ( ghahramani & jordan , 123; williams & hinton , 123 ) .
the graphical model for a factorial hmm ( fhmm ) is shown in gure 123
the system is composed of a set of m chains indexed by m .
let the state node for the mth chain at time i be represented by x . m / and let the transition matrix for the mth chain be rep - resented by a . m / .
we can view the effective state space for the fhmm as the cartesian product of the state spaces associated with the individual chains .
the overall transition probability for the system is obtained by taking the product across the intra - chain transition
introduction to variational methods
figure 123
a factorial hmm with three chains .
the transition matrices are a . 123 / , a . 123 / , and a . 123 / associated with the horizontal edges , and the output probabilities are determined by matrices b . 123 / , b . 123 / , and b . 123 / associated with the vertical edges .
p . xi j xi123 / d my
where the symbol xi stands for the m - tuple . x . 123 /
; x . 123 /
; : : : ; x . m /
ghahramani and jordan utilized a linear - gaussian distribution for the emission proba -
bilities of the fhmm .
in particular , they assumed :
p . yi j xi / d n
b . m / x . m /
where the b . m / and 123 are matrices of parameters .
the fhmm is a natural model for systems in which the hidden state is realized via the joint conguration of an uncoupled set of dynamical systems .
moreover , an fhmm is able to represent a large effective state space with a much smaller number of parameters than a single unstructured cartesian product hmm .
for example , if we have 123 chains and in each chain the nodes have 123 states , the effective state space is of size 123 , 123 , while the transition probabilities are represented compactly with only 123 parameters .
a single unstructured hmm would require 123 parameters for the transition matrix in this case .
the fact that the output is a function of the states of all of the chains implies that the states become stochastically coupled when the outputs are observed .
let us investigate the implications of this fact for the time complexity of exact inference in the fhmm .
figure 123 shows a triangulation for the case of two chains ( in fact this is an optimal triangulation ) .
jordan et al .
figure 123
a triangulation of an fhmm with two component chains .
the moralization step links states at a single time step .
the triangulation step links states diagonally between neighboring time steps .
figure 123
a triangulation of the state nodes of a three - chain fhmm with three component chains .
( the obser - vation nodes have been omitted in the interest of simplicity . )
figure 123
this graph is not a triangulation of a three - chain fhmm .
the cliques for the hidden states are of size n 123; thus the time complexity of exact inference is o . n 123t / , where n is the number of states in each chain ( we assume that each chain has the same number of states for simplicity ) .
figure 123 shows the case of a triangulation of three chains; here the triangulation ( again optimal ) creates cliques of size n 123
( note in particular that the graph in gure 123 , with cliques of size three , is not a triangulation; there
introduction to variational methods
are 123 - cycles without a chord ) .
in the general case , it is not difcult to see that cliques of size n mc123 are created , where m is the number of chains; thus the complexity of exact inference for the fhmm scales as o . n mc123t / .
for a single unstructured cartesian product hmm having the same number of states as the fhmmi . e . , n m statesthe complexity scales as o . n 123m t / , thus exact inference for the fhmm is somewhat less costly , but the exponential growth in complexity in either case shows that exact inference is infeasible for
higher - order hidden markov models
a related variation on hmms considers a higher - order markov model in which each state depends on the previous k states instead of the single previous state .
in this case it is again readily shown that the time complexity is exponential in k .
we will not discuss the higher - order hmm further in this paper; for a variational algorithm for the higher - order hmm see saul and jordan ( 123 ) .
hidden markov decision trees
finally , we consider a model in which a decision tree is endowed with markovian dynamics ( jordan , ghahramani , & saul , 123 ) .
a decision tree can be viewed as a graphical model by modeling the decisions in the tree as multinomial random variables , one for each level of the decision tree .
referring to gure 123 , and focusing on a particular time slice , the shaded node at the top of the diagram represents the input vector .
the unshaded nodes below the input nodes are the decision nodes .
each of the decision nodes are conditioned on the input
figure 123
a hidden markov decision tree .
the shaded nodes fuig and fyig represent a time series in which each element is an ( input , output ) pair .
linking the inputs and outputs are a sequence of decision nodes which correspond to branches in a decision tree .
these decisions are linked horizontally to represent markovian temporal
jordan et al .
and on the entire sequence of preceding decisions ( the vertical arrows in the diagram ) .
in terms of a traditional decision tree diagram , this dependence provides an indication of the path followed by the data point as it drops through the decision tree .
the node at the bottom of the diagram is the output variable .
if we now make the decisions in the decision tree conditional not only on the current data point , but also on the decisions at the previous moment in time , we obtain a hidden markov decision tree ( hmdt ) .
in gure 123 , the horizontal edges represent this markovian temporal dependence .
note in particular that the dependency is assumed to be level - specicthe probability of a decision depends only on the previous decision at the same level of the
given a sequence of input vectors ui and a corresponding sequence of output vectors yi , the inference problem is to compute the conditional probability distribution over the hidden states .
this problem is intractable for general hmdtsas can be seen by noting that the hmdt includes the fhmm as a special case .
basics of variational methodology
variational methods are used as approximation methods in a wide variety of settings , includ - ing nite element analysis ( bathe , 123 ) , quantum mechanics ( sakurai , 123 ) , statistical mechanics ( parisi , 123 ) , and statistics ( rustagi , 123 ) .
in each of these cases the applica - tion of variational methods converts a complex problem into a simpler problem , where the simpler problem is generally characterized by a decoupling of the degrees of freedom in the original problem .
this decoupling is achieved via an expansion of the problem to include additional parameters , known as variational parameters , that must be t to the problem at
the terminology comes from the roots of the techniques in the calculus of variations .
we will not start systematically from the calculus of variations; instead , we will jump off from an intermediate point that emphasizes the important role of convexity in variational approximation .
this point of view turns out to be particularly well suited to the development of variational methods for graphical models .
let us begin by considering a simple example .
in particular , let us express the logarithm
ln . x / d min
fx ln 123g :
in this expression is the variational parameter , and we are required to perform the min - imization for each value of x .
the expression is readily veried by taking the derivative with respect to , solving and substituting .
the situation is perhaps best appreciated geo - metrically , as we show in gure 123
note that the expression in braces in eq .
( 123 ) is linear in x with slope .
clearly , given the concavity of the logarithm , for each line having slope
introduction to variational methods
figure 123
variational transformation of the logarithm function .
the linear functions . x ln 123 / form a family of upper bounds for the logarithm , each of which is exact for a particular value of x .
there is a value of the intercept such that the line touches the logarithm at a single point .
indeed , ln 123 in eq .
( 123 ) is precisely this intercept .
moreover , if we range across , the family of such lines forms an upper envelope of the logarithm function .
that is , for any given x , we have :
ln . x / x ln 123;
for all .
thus the variational transformation provides a family of upper bounds on the logarithm .
the minimum over these bounds is the exact value of the logarithm .
the pragmatic justication for such a transformation is that we have converted a nonlinear function into a linear function .
the cost is that we have obtained a free parameter that must be set , once for each x .
for any value of we obtain an upper bound on the logarithm; if we set well we can obtain a good bound .
indeed we can recover the exact value of logarithm for the optimal choice of .
let us now consider a second example that is more directly relevant to graphical models .
for binary - valued nodes it is common to represent the probability that the node takes one of its values via a monotonic nonlinearity that is a simple functione . g . , a linear functionof the values of the parents of the node .
an example is the logistic regression model :
f . x / d
123 c ex
which we have seen previously in eq .
here x is the weighted sum of the values of the parents of a node .
jordan et al .
the logistic function is neither convex nor concave , so a simple linear bound will not
however , the logistic function is log concave .
that is , the function
g . x / d ln . 123 c e
is a concave function of x ( as can readily be veried by calculating the second derivative ) .
thus we can bound the log logistic function with linear functions and thereby bound the logistic function by the exponential .
in particular , we can write :
g . x / d min
fx h . / g;
where h . / is the binary entropy function , h . / d ln . 123 / ln . 123 / .
( we will explain how the binary entropy function arises below; for now it sufces to think of it simply as the appropriate intercept term for the log logistic function ) .
we now take the exponential of both sides , noting that the minimum and the exponential function commute :
f . x / d min
this is a variational transformation for the logistic function; examples are plotted in g - ure 123
finally , we note once again that for any value of we obtain an upper bound of the logistic function for all values of x :
f . x / exh . / :
good choices for provide better bounds .
figure 123
variational transformation of the logistic function .
introduction to variational methods
the advantages of the transformation in eq .
( 123 ) are signicant in the context of graphical models .
in particular , to obtain the joint probability in a graphical model we are required to take a product over the local conditional probabilities ( cf .
for conditional probabilities represented with logistic regression , we obtain products of functions of the form f . x / d 123= . 123ce x / .
such a product is not in a simple form .
if instead we augment our network representation by including variational parametersi . e .
representing each logistic function variationally as in eq .
( 123 ) we see that a bound on the joint probability is obtained by taking products of exponentials .
this is tractable computationally , particularly so given that the exponents are linear in x .
convex duality
can we nd variational transformations more systematically ? indeed , many of the vari - ational transformations that have been utilized in the literature on graphical models are examples of the general principle of convex duality .
it is a general fact of convex analysis ( rockafellar , 123 ) that a concave function f . x / can be represented via a conjugate or dual function as follows : f . x / d min
ft x f
. / can be obtained
where we now allow x and to be vectors .
the conjugate function f from the following dual expression : ft x f . x / g :
. / d min
this relationship is easily understood geometrically , as shown in gure 123
here we plot f . x / and the linear function x for a particular value of .
the short vertical segments
figure 123
the conjugate function f linesbetween x and f . x / .
. / is obtained by minimizing across the deviationsrepresented as dashed
jordan et al .
represent values x f . x / .
it is clear from the gure that we need to shift the linear function x vertically by an amount which is the minimum of the values x f . x / in order to obtain an upper bounding line with slope that touches f . x / at a single point .
this observation both justies the form of the conjugate function , as a minimum over differences x f . x / , and explains why the conjugate function appears as the intercept in eq .
ln c 123 , and the conjugate function for the log logistic function is the binary entropy h . / .
although we have focused on upper bounds in this section , the framework of convex
it is an easy exercise to verify that the conjugate function for the logarithm is f
duality applies equally well to lower bounds; in particular for convex f . x / we have :
f . x / d max
ft x f
. / d max
ft x f . x / g
is the conjugate function .
we have focused on linear bounds in this section , but convex duality is not restricted to linear bounds .
more general bounds can be obtained by transforming the argument of the function of interest rather than the value of the function ( jaakkola & jordan , 123a ) .
for example , if f . x / is concave in x 123 we can write :
fx 123 nf
f . x / d min . / is the conjugate function of nf . x / f . x 123 / .
thus the transformation yields a quadratic bound on f . x / .
it is also worth noting that such transformations can be combined with the logarithmic transformation utilized earlier to obtain gaussian representations for the upper bounds .
this can be useful in obtaining variational approximations for posterior distributions ( jaakkola & jordan , 123b ) .
to summarize , the general methodology suggested by convex duality is the following .
we wish to obtain upper or lower bounds on a function of interest .
if the function is already convex or concave then we simply calculate the conjugate function .
if the function is not convex or concave , then we look for an invertible transformation that renders the function convex or concave .
we may also consider transformations of the argument of the function .
we then calculate the conjugate function in the transformed space and transform back .
for this approach to be useful we need to nd a transform , such as the logarithm , whose inverse has useful algebraic properties .
approximations for joint probabilities and conditional probabilities
the discussion thus far has focused on approximations for the local probability distributions at the nodes of a graphical model .
how do these approximations translate into approxima - tions for the global probabilities of interest , in particular for the conditional distribution
introduction to variational methods
p . h j e / that is our interest in the inference problem and the marginal probability p . e / that is our interest in learning problems ? let us focus on directed graphs for concreteness .
suppose that we have a lower bound and an upper bound for each of the local conditional probabilities p . si j s . i / / .
that is , assume that we have forms pu . si j s . i / ; u / and p l . si j s . i / ; l / , providing upper and lower bounds , respectively , where u i and l i are ( generally different ) variational para - meterizations appropriate for the upper and lower bounds .
consider rst the upper bounds .
given that the product of upper bounds is an upper bound , we have :
s . i / ; u
this inequality holds for arbitrary settings of values of the variational parameters u moreover , eq .
( 123 ) must hold for any subset of s whenever some other subset is held xed; this implies that upper bounds on marginal probabilities can be obtained by taking sums over the variational form on the right - hand side of the equation .
for example , letting e and h be a disjoint partition of s , we have :
p . e / d
p . h; e /
s . i / ; u
where , as we will see in the examples to be discussed below , we choose the variational forms pu . si j s . i / ; u / so that the summation over h can be carried out efciently ( this is the key step in developing a variational method ) .
in either eq .
( 123 ) or eq .
( 123 ) , given that these upper bounds hold for any settings of values the variational parameters u i , they hold in particular for optimizing settings of the parameters .
that is , we can treat the right - hand side of eq .
( 123 ) or the right - hand side of eq .
( 123 ) as a function to be minimized with respect to u i .
in the latter case , this optimization process will induce interdependencies between the parameters u i .
these interdependencies are desirable; indeed they are critical for obtaining a good variational bound on the marginal probability of interest .
in particular , the best global bounds are obtained when the probabilistic dependencies in the distribution are reected in dependencies in the approximation .
to clarify the nature of variational bounds , note that there is an important distinction to be made between joint probabilities ( eq .
( 123 ) ) and marginal probabilities ( eq .
( 123 ) , if we allow the variational parameters to be set optimally for each value of the argument s , then it is possible ( in principle ) to nd optimizing settings of the variational parameters that recover the exact value of the joint probability .
( here we assume that the local probabilities p . si j s . i / / can be represented exactly via a variational transformation , as in the examples discussed in section 123 ) .
( 123 ) , on the other hand , we are not generally able to recover exact values of the marginal by optimizing over variational parameters that depend only on the argument e .
consider , for example , the case of a node si 123 e that has parents in h .
jordan et al .
as we range across fhg there will be summands on the right - hand side of eq .
( 123 ) that will involve evaluating the local probability p . si j s . i / / for different values of the parents s . i / .
if the variational parameter u i depends only on e , we cannot in general expect to obtain an exact representation for p . si j s . i / / in each summand .
thus , some of the summands in eq .
( 123 ) are necessarily bounds and not exact values .
this observation provides a bit of insight into reasons why a variational bound might be expected to be tight in some circumstances and loose in others .
in particular , if p . si j s . i / / is nearly constant as we range across s . i / , or if we are operating at a point where the variational representation is fairly insensitive to the setting of u ( for example the right - hand side of the logarithm in gure 123 ) , then the bounds may be expected to be tight .
on the other hand , if these conditions are not present one might expect that the bound would be loose .
however the situation is complicated by the interdependencies between the u are induced during the optimization process .
we will return to these issues in the discussion .
although we have discussed upper bounds , similar comments apply to lower bounds , and to marginal probabilities obtained from lower bounds on the joint distribution .
the conditional distribution p . h j e / , on the other hand , is the ratio of two marginal distributions; i . e . , p . h j e / d p . h; e / =p . e / . 123 to obtain upper and lower bounds on the conditional distribution , we must have upper and lower bounds on both the numerator and the denominator .
generally speaking , however , if we can obtain upper and lower bounds on the denominator , then our labor is essentially nished , because the numerator involves fewer sums .
indeed , in the case in which s d h ( e , the numerator involves no sums and is simply a function evaluation .
finally , it is worth noting that variational methods can also be of interest simply as tractable approximations rather than as methods that provide strict bounds ( much as sam - pling methods are used ) .
one way to do this is to obtain a variational approximation that is a bound for a marginal probability , and to substitute the variational parameters thus obtained into the conditional probability distribution .
thus , for example , we might obtain a lower bound on the likelihood p . e / by tting variational parameters .
we can substi - tute these parameters into the parameterized variational form for p . h; e / and then utilize this variational form as an efcient inference engine in calculating an approximation to p . h j e / .
in the following sections we will illustrate the general variational framework as it has been applied in a number of worked - out examples .
all of these examples involve architec - tures of practical interest and provide concrete examples of variational methodology .
to a certain degree the examples also serve as case histories that can be generalized to related architectures .
it is important to emphasize , however , that it is not necessarily straightfor - ward to develop a variational approximation for a new architecture .
the ease and the utility of applying the methods outlined in this section depend on architectural details , including the choice of node probability functions , the graph topology and the particular parameter regime in which the model is operated .
in particular , certain choices of node conditional probability functions lend themselves more readily than others to variational transforma - tions that have useful algebraic properties .
also , certain architectures simplify more readily under variational transformation than others; in particular , the marginal bounds in eq .
( 123 ) are simple functions in some cases and complex in others .
these issues are currently not
introduction to variational methods
well understood and the development of effective variational approximations can in some cases require substantial creativity .
sequential and block methods
let us now consider in somewhat more detail how variational methods can be applied to probabilistic inference problems .
the basic idea is that suggested abovewe wish to simplify the joint probability distribution by transforming the local probability functions .
by an appropriate choice of variational transformation , we can simplify the form of the joint probability distribution and thereby simplify the inference problem .
we can transform some or all of the nodes .
the cost of performing such transformations is that we obtain bounds or approximations to the probabilities rather than exact results .
the option of transforming only some of the nodes is important; it implies a role for the exact methods as subroutines within a variational approximation .
in particular , partial transformations of the graph may leave some of the original graphical structure intact and / or introduce new graphical structure to which exact methods can be fruitfully applied .
in general , we wish to use variational approximations in a limited way , transforming the graph into a simplied graph to which exact methods can be applied .
this will in general yield tighter bounds than an algorithm that transforms the entire graph without regard for computationally tractable substructure .
the majority of variational algorithms proposed in the literature to date can be divided into two main classes : sequential and block .
in the sequential approach , nodes are transformed in an order that is determined during the inference process .
this approach has the advantage of exibility and generality , allowing the particular pattern of evidence to determine the best choices of nodes to transform .
in some cases , however , particularly when there are obvious substructures in a graph which are amenable to exact methods , it can be advantageous to designate in advance the nodes to be transformed .
we will see that this block approach is particularly natural in the setting of parameter estimation .
the sequential approach
the sequential approach introduces variational transformations for the nodes in a particu - lar order .
the goal is to transform the network until the resulting transformed network is amenable to exact methods .
as we will see in the examples below , certain variational trans - formations can be understood graphically as a sparsication in which nodes are removed from the graph .
if a sufcient number of variational transformations are introduced the resulting graph becomes sufciently sparse such that an exact method becomes applicable .
an operational denition of sparseness can be obtained by running a greedy triangulation algorithmthis upper bounds the run time of the junction tree inference algorithm .
there are basically two ways to implement the sequential approachone can begin with the untransformed graph and introduce variational transformations one node at a time , or one can begin with a completely transformed graph and reintroduce exact conditional probabilities one node at a time .
an advantage of the latter approach is that the graph remains tractable at all times; thus it is feasible to directly calculate the quantitative effect
jordan et al .
of transforming or reintroducing a given node .
in the former approach the graph is intractable throughout the search , and the only way to assessing a transformation is via its qualitative effect on graphical sparseness .
the sequential approach is perhaps best presented in the context of a specic example .
in the following section we return to the qmr - dt network and show how a sequential variational approach can be used for inference in this network .
the qmr - dt network
jaakkola and jordan ( 123b ) present an application of sequential variational methods to the qmr - dt network .
as we have seen , the qmr - dt network is a bipartite graph in which the conditional probabilities for the ndings are based on the noisy - or model ( eq .
( 123 ) for the negative ndings and eq .
( 123 ) for the positive ndings ) .
note that symptom nodes that are not ndingsi . e . , symptoms that are not observedcan simply be marginalized out of the joint distribution by omission and therefore they have no impact on inference .
moreover , as we have discussed , the negative ndings present no difculties for inferencegiven the exponential form of the probability in eq .
( 123 ) , the effects of negative ndings on the disease probabilities can be handled in linear time .
let us therefore assume that the updates associated with the negative ndings have already been made and focus on the problem of performing inference when there are positive ndings .
repeating eq .
( 123 ) for convenience , we have the following representation for the proba -
bility of a positive nding :
fi d 123 j d / d 123 exp
( cid : 123 ) i j d j ( cid : 123 ) i123
the function 123 e x is log concave; thus , as in the case of the logistic function , we are able to express the variational upper bound in terms of the exponential of a linear function .
x ex f
where the conjugate function is as follows : . / d ln c .
c 123 / ln
plugging the argument of eq .
( 123 ) into eq .
( 123 ) , and noting that we need a different varia - tional parameter i for each transformed node , we obtain :
fi d 123 j d / exp
( cid : 123 ) i j d j c ( cid : 123 ) i123
( ei ( cid : 123 ) i j ) d j :
d ei ( cid : 123 ) i123 f
introduction to variational methods
figure 123
the qmr - dt graph after the lightly shaded nding has been subjected to a variational transformation .
the effect is equivalent to delinking the node from the graph .
the nal equation displays the effect of the variational transformation .
the exponential factor outside of the product is simply a constant .
the product is taken over all nodes in the parent set for node i , but unlike the case in which the graph is moralized for exact computation , the contributions associated with the d j nodes are uncoupled .
that is , each factor exp . i ( cid : 123 ) i j / is simply a constant that can be multiplied into the probability that was previously associated with node d j ( for d j d 123 ) .
there is no coupling of d j and dk nodes as there would be if we had taken products of the untransformed noisy - or .
thus the graphical effect of the variational transformation is as shown in gure 123; the variational transformation delinks the ith nding from the graph .
in our particular example , the graph is now rendered singly connected and an exact inference algorithm can be invoked .
( recall that marginalizing over the unobserved symptoms simply removes them from the graph ) .
the sequential methodology utilized by jaakkola and jordan begins with a completely transformed graph and then reinstates exact conditional probabilities at selected nodes .
to choose the ordering in which to reinstate nodes , jaakkola and jordan make use of a heuristic , basing the choice on the effect on the likelihood bound of reinstating each node individually starting from the completely transformed state .
despite the suboptimality of this heuristic , they found that it yielded an approximation that was orders of magnitude more accurate than that of an algorithm that used a random ordering .
given the ordering the algorithm then proceeds as follows : ( 123 ) choose the next node in the ordering , and consider the effect of reintroducing the links associated with the node into the current graph .
( 123 ) if the resulting graph is still amenable to exact methods , reinstate the node and iterate .
otherwise stop and run an exact method .
finally , ( 123 ) we must also choose the parameters i so as to make the approximation as tight as possible .
it is not difcult to verify that products of the expression in eq .
( 123 ) yield an overall bound that is a convex function of the i parameters ( jaakkola & jordan , 123b ) .
thus standard optimization algorithms can be used to nd good choices for the i .
figure 123 shows results from jaakkola and jordan ( 123b ) for approximate inference on four of the cpc cases that were mentioned earlier .
for these four cases there were a sufciently small number of positive ndings that an exact algorithm could be run to provide a gold standard for comparison .
the leftmost gure shows upper and lower bounds
jordan et al .
( a ) exact values and variational upper and lower bounds on the log - likelihood for the four tractable cpc cases .
( b ) the mean correlation between the approximate and exact posterior marginals as a function of the execution time ( seconds ) .
solid line : variational estimates; dashed line : likelihood - weighting sampling .
the lines above and below the sampling result represent standard errors of the mean based on the ten independent runs of
on the log - likelihood for these cases .
jaakkola and jordan also calculated approximate posterior marginals for the diseases .
the correlations of these marginals with the gold standard are shown in the rightmost gure .
this gure plots accuracy against run time , for runs in which 123 , 123 , and 123 positive ndings were treated exactly .
note that accurate values were obtained in less than a second .
the gure also shows results from a state - of - the - art sampling algorithm ( the likelihood - weighted sampler of shwe and cooper , 123 ) .
the sampler required signicantly more computer time than the variational method to obtain roughly comparable accuracy .
jaakkola and jordan ( 123b ) also presented results for the entire corpus of cpc cases .
they again found that the variational method yielded reasonably accurate estimates of the posterior probabilities of the diseases ( using lengthy runs of the sampler as a basis for comparison ) within less than a second of computer time .
the boltzmann machine
let us now consider a rather different example .
as we have discussed , the boltzmann machine is a special subset of the class of undirected graphical models in which the potential functions are composed of products of quadratic and linear boltzmann factors .
jaakkola and jordan ( 123a ) introduced a sequential variational algorithm for approximate inference in the boltzmann machine .
their method , which we discuss in this section , yields both upper and lower bounds on marginal and conditional probabilities of interest .
recall the form of the joint probability distribution for the boltzmann machine :
p . s / d exp
( cid : 123 ) i j si s j cp
to obtain marginal probabilities such as p . e / under this joint distribution , we must calculate sums over exponentials of quadratic energy functions .
moreover , to obtain conditional
introduction to variational methods
probabilities such as p . h j e / d p . h; e / =p . e / , we take ratios of such sums , where the numerator requires fewer sums than the denominator .
the most general such sum is the partition function itself , which is a sum over all congurations fsg .
let us therefore focus on upper and lower bounds for the partition function as the general case; this allows us to calculate bounds on any other marginals or conditionals of interest .
our approach is to perform the sums one sum at a time , introducing variational trans - formations to ensure that the resulting expression stays computationally tractable .
in fact , at every step of the process that we describe , the transformed potentials involve no more than quadratic boltzmann factors .
( exact methods can be viewed as creating increasingly higher - order terms when the marginalizing sums are performed ) .
thus the transformed boltzmann machine remains a boltzmann machine .
let us rst consider lower bounds .
we write the partition function as follows :
( cid : 123 ) jk s j sk c
( cid : 123 ) j123s j
( cid : 123 ) jk s j sk c
( cid : 123 ) j123s j
and attempt to nd a tractable lower bound on the inner summand over si on the right - hand side .
it is not difcult to show that this expression is log convex .
thus we bound its logarithm
f j <kg123di
f j <kg123di
f j <kg123di
( cid : 123 ) jk s j sk c
( cid : 123 ) jk s j sk c
( cid : 123 ) j123s j c ln
( cid : 123 ) jk s j sk c
( cid : 123 ) j123s j c ln
( cid : 123 ) jk s j sk c
( cid : 123 ) j123s j c l
( cid : 123 ) j123s j
123 c exp
( cid : 123 ) i j s j c ( cid : 123 ) i123
( cid : 123 ) i j si s j c ( cid : 123 ) i123si
( cid : 123 ) i j s j c ( cid : 123 ) i123
where the sum in the rst term on the right - hand side is a sum over all pairs j < k such that neither j nor k is equal to i , where h . / is as before the binary entropy function , and where is the variational parameter associated with node si .
in the rst line we have simply pulled outside of the sum all of those terms not involving si , and in the second line we have performed the sum over the two values of si .
finally , to lower bound the expression in eq .
( 123 ) we need only lower bound the term ln . 123c ex / on the right - hand side .
but we have already found variational bounds for a related expression in treating the logistic function; recall eq .
the upper bound in that case translates into the lower bound in the current
jordan et al .
figure 123
the transformation of the boltzmann machine under the approximate marginalization over node si for the case of lower bounds .
( a ) the boltzmann machine before the transformation .
( b ) the boltzmann machine after the transformation , where si has become delinked .
all of the pairwise parameters , ( cid : 123 ) jk , for j and k not equal to i , have remained unaltered .
as suggested by the wavy lines , the linear coefcients have changed for those nodes that were neighbors of si .
ln . 123 c e
x / x c h . / :
this is the bound that we have utilized in eq
let us consider the graphical consequences of the bound in eq .
( 123 ) ( see gure 123 ) .
note that for all nodes in the graph other than node si and its neighbors , the boltzmann factors are unaltered ( see the rst two terms in the bound ) .
thus the graph is unaltered for such nodes .
from the term in parentheses we see that the neighbors of node si have been endowed with new linear terms; importantly , however , these nodes have not become linked ( as they would have become if we had done the exact marginalization ) .
neighbors that were linked previously remain linked with the same ( cid : 123 ) jk parameter .
node si is absent from the transformed partition function and thus absent from the graph , but it has left its trace via the new linear boltzmann factors associated with its neighbors .
we can summarize the effects of the transformation by noting that the transformed graph is a new boltzmann machine with one fewer node and the following parameters :
q ( cid : 123 ) jk d ( cid : 123 ) jk q ( cid : 123 ) j123 d ( cid : 123 ) j123 c l
j; k 123d i j 123d i :
( cid : 123 ) i123 c h . l
note nally that we also have a constant term l / to keep track of .
this term will have an interesting interpretation when we return to the boltzmann machine later in the context of block methods .
upper bounds are obtained in a similar way .
we again break the partition function into a sum over a particular node si and a sum over the congurations of the remaining nodes snsi .
moreover , the rst three lines of the ensuing derivation leading to eq .
( 123 ) are identical
introduction to variational methods
complete the derivation we now nd an upper bound on ln . 123 c ex / .
jaakkola and jordan ( 123a ) proposed using quadratic bounds for this purpose .
in particular , they noted that :
ln . 123 c ex / d ln . ex=123 c e
x=123 / c x
and that ln . ex=123 c e x=123 / is a concave function of x 123 ( as can be veried by taking the second derivative with respect to x 123 ) .
this implies that ln . 123 c ex / must have a quadratic upper bound of the following form : ln . 123 c ex / x 123 c x . / is an appropriately dened conjugate function .
using these upper bounds in
( cid : 123 ) jk s j sk c
( cid : 123 ) j123s j
( 123 ) we obtain :
( cid : 123 ) jk s j sk c
( cid : 123 ) j123s j
! 123 c 123
( cid : 123 ) i j s j c ( cid : 123 ) i123
f j <kg123di
( cid : 123 ) i j s j c ( cid : 123 ) i123
is the variational parameter associated with node si .
the graphical consequences of this transformation are somewhat different than those of the lower bounds ( see gure 123 ) .
considering the rst two terms in the bound , we see that
figure 123
the transformation of the boltzmann machine under the approximate marginalization over node si for the case of upper bounds .
( a ) the boltzmann machine before the transformation .
( b ) the boltzmann machine after the transformation , where si has become delinked .
as the dashed edges suggest , all of the neighbors of si have become linked and those that were formerly linked have new parameter values .
as suggested by the wavy lines , the neighbors of si also have new linear coefcients .
all other edges and parameters are unaltered .
q ( cid : 123 ) jk d ( cid : 123 ) jk c 123u q ( cid : 123 ) j123 d ( cid : 123 ) j123 c ( cid : 123 ) i j
( cid : 123 ) ji ( cid : 123 ) ik
( cid : 123 ) i123 ( cid : 123 ) i j c u
j; k 123d i j 123d i :
jordan et al .
it is still the case that the graph is unaltered for all nodes in the graph other than node si and its neighbors , and moreover neighbors of si that were previously linked remain linked .
the quadratic term , however , gives rise to new links between the previously unlinked neighbors of node si and alters the parameters between previously linked neighbors .
each of these nodes also acquires a new linear term .
expanding eq .
( 123 ) and collecting terms , we see that the approximate marginalization has yielded a boltzmann machine with the following
finally , the constant term is given by ( cid : 123 ) i123=123 c u the graphical consequences of the lower and upper bound transformations also have com - putational consequences .
in particular , given that the lower bound transformation introduces no additional links when nodes are delinked , it is somewhat more natural to combine these transformations with exact methods .
in particular , the algorithm simply delinks nodes until a tractable structure ( such as a tree ) is revealed; at this point an exact algorithm is called as a subroutine .
the upper bound transformation , on the other hand , by introducing links between the neighbors of a delinked node , does not reveal tractable structure as readily .
this seeming disadvantage is mitigated by the fact that the upper bound is a tighter bound ( jaakkola & jordan , 123a ) .
the block approach
an alternative approach to variational inference is to designate in advance a set of nodes that are to be transformed .
we can in principle view this block approach as an off - line application of the sequential approach .
in the case of lower bounds , however , there are ad - vantages to be gained by developing a methodology that is specic to block transformation .
in this section , we show that a natural global measure of approximation accuracy can be obtained for lower bounds via a block version of the variational formalism .
the method meshes readily with exact methods in cases in which tractable substructure can be identi - ed in the graph .
this approach was rst presented by saul and jordan ( 123 ) , as a rened version of mean eld theory for markov random elds , and has been developed further in a number of recent studies ( e . g . , ghahramani & jordan , 123; ghahramani & hinton , 123; jordan et al . , 123 ) .
in the block approach , we begin by identifying a substructure in the graph of interest that we know is amenable to exact inference methods ( or , more generally , to efcient approximate inference methods ) .
for example , we might pick out a tree or a set of chains in the original graph .
we wish to use this simplied structure to approximate the probability distribution on the original graph .
to do so , we consider a family of probability distributions that are obtained from the simplied graph via the introduction of variational parameters .
we choose a particular approximating distribution from the simplifying family by making a particular choice for the variational parameters .
as in the sequential approach a new choice of variational parameters must be made each time new evidence is available .
introduction to variational methods
more formally , let p . s / represent the joint distribution on the graphical model of interest , where as before s represents all of the nodes of the graph and h and e are disjoint subsets of s representing the hidden nodes and the evidence nodes , respectively .
we wish to approximate the conditional probability p . h j e / .
we introduce an approximating family of conditional probability distributions , q . h j e ; / , where are variational parameters .
the graph representing q is not generally the same as the graph representing p; generally it is a sub - graph .
from the family of approximating distributions q , we choose a particular distribution by minimizing the kullback - leibler ( kl ) divergence , d . q k p / , with respect to the variational parameters :
d arg min d . q . h j e ; / k p . h j e / / ;
d . q k p / d
where for any probability distributions q . s / and p . s / the kl divergence is dened as
the minimizing values of the variational parameters , , dene a particular distribu - tion , q . h j e ; / , that we treat as the best approximation of p . h j e / in the family q . h j e ; / .
one simple justication for using the kl divergence as a measure of approximation accuracy is that it yields the best lower bound on the probability of the evidence p . e / ( i . e . , the likelihood ) in the family of approximations q . h j e ; / .
indeed , we bound the logarithm of p . e / using jensens inequality as follows :
p . h; e /
ln p . e / d ln
q . h j e / p . h; e / q . h j e / p . h; e / q . h j e /
q . h j e / ln
the difference between the left and right hand sides of this equation is easily seen to be the kl divergence d . q k p / .
thus , by the positivity of the kl divergence ( cover & thomas , 123 ) , the right - hand side of eq .
( 123 ) is a lower bound on p . e / .
moreover , by choosing according to eq .
( 123 ) , we obtain the tightest lower bound .
convex duality and the kl divergence
we can also justify the choice of kl divergence by making an appeal to convex duality theory , thereby linking the block approach with the sequential approach ( jaakkola , 123 ) .
consider , for simplicity , the case of discrete - valued nodes h .
the distribution q . h j e ; /
jordan et al .
can be viewed as a vector of real numbers , one for each conguration of the variables h .
treat this vector as the vector - valued variational parameter in eq .
moreover , the log probability ln p . h; e / can also be viewed as a vector of real numbers , dened on the set of congurations of h .
treat this vector as the variable x in eq .
finally , dene f . x / to be ln p . e / .
it can be veried that the following expression for ln p . e / :
ln p . e / d ln
eln p . h;e /
is indeed convex in the values ln p . h; e / .
moreover , by direct substitution in eq
. q / d min
q . h j e ; / ln p . h; e / ln p . e /
and minimizing with respect to ln p . h; e / , the conjugate function f the negative entropy function lower bound the log likelihood as follows :
. q / is seen to be fhg q . h j e / ln q . h j e / .
thus , using eq .
( 123 ) , we can
ln p . e /
q . h j e / ln p . h; e / q . h j e / ln q . h j e /
this is identical to eq .
moreover , we see that we could in principle recover the exact log likelihood if q were allowed to range over all probability distributions q . h j e / .
by ranging over a parameterized family q . h j e ; / , we obtain the tightest lower bound that is available within the family .
parameter estimation via variational methods
neal and hinton ( 123 ) have pointed out that the lower bound in eq .
( 123 ) has a useful role to play in the context of maximum likelihood parameter estimation .
in particular , they make a link between this lower bound and parameter estimation via the em algorithm .
let us augment our notation to include parameters ( cid : 123 ) in the specication of the joint probability distribution p . s j ( cid : 123 ) / .
as before , we designate a subset of the nodes e as the observed evidence .
the marginal probability p . e j ( cid : 123 ) / , thought of as a function of ( cid : 123 ) , is known as the likelihood .
the em algorithm is a method for maximum likelihood parameter estimation that hillclimbs in the log likelihood .
it does so by making use of the convexity relationship between ln p . h; e j ( cid : 123 ) / and ln p . e j ( cid : 123 ) / described in the previous section .
in section 123 we showed that the function
l . q; ( cid : 123 ) / d
q . h j e / ln p . h; e j ( cid : 123 ) / q . h j e / ln q . h j e /
is a lower bound on the log likelihood for any probability distribution q . h j e / .
moreover , we showed that the difference between ln p . e j ( cid : 123 ) / and the bound l . q; ( cid : 123 ) / is the kl divergence between q . h j e / and p . h j e / .
suppose now that we allow q . h j e / to
introduction to variational methods
range over all possible probability distributions on h and minimize the kl divergence .
it is a standard result ( cf .
cover & thomas , 123 ) that the kl divergence is minimized by choosing q . h j e / d p . h j e ; ( cid : 123 ) / , and that the minimal value is zero .
this is veried by substituting p . h j e ; ( cid : 123 ) / into the right - hand side of eq .
( 123 ) and recovering ln p . e j ( cid : 123 ) / .
this suggests the following algorithm .
starting from an initial parameter vector ( cid : 123 ) . 123 / , we iterate the following two steps , known as the e ( expectation ) step and the m ( maximiza - tion ) step .
first , we maximize the bound l . q; ( cid : 123 ) / with respect to probability distributions q .
second , we x q and maximize the bound l . q; ( cid : 123 ) / with respect to the parameters ( cid : 123 ) .
more formally , we have :
( e step ) : q . kc123 / d arg max ( m step ) : ( cid : 123 ) . kc123 / d arg max
q; ( cid : 123 ) . k /
which is coordinate ascent in l . q; ( cid : 123 ) / .
this can be related to the traditional presentation of the em algorithm ( dempster , laird , & rubin , 123 ) by noting that for xed q , the right - hand side of eq .
( 123 ) is a function of ( cid : 123 ) only through the ln p . h; e j ( cid : 123 ) / term .
thus maximizing l . q; ( cid : 123 ) / with respect to ( cid : 123 ) in the m step is equivalent to maximizing the following function :
h j e ; ( cid : 123 ) . k /
ln p . h; e j ( cid : 123 ) / :
maximization of this function , known as the complete log likelihood in the em literature , denes the m step in the traditional presentation of em .
let us now return to the situation in which we are unable to compute the full conditional distribution p . h j e ; ( cid : 123 ) / .
in such cases variational methodology suggests that we consider a family of approximating distributions .
although we are no longer able to perform a true em iteration given that we cannot avail ourselves of p . h j e ; ( cid : 123 ) / , we can still perform coordinate ascent in the lower bound l . q; ( cid : 123 ) / .
indeed , the variational strategy of minimi - zing the kl divergence with respect to the variational parameters that dene the approx - imating family is exactly a restricted form of coordinate ascent in the rst argument of l . q; ( cid : 123 ) / .
we then follow this step by an m step that increases the lower bound with respect to the parameters ( cid : 123 ) .
this point of view , which can be viewed as a computationally tractable approximation to the em algorithm , has been exploited in a number of recent architectures , including the sigmoid belief network , factorial hidden markov model and hidden markov decision tree architectures that we discuss in the following sections , as well as the helmholtz machine of dayan et al .
( 123 ) and hinton et al .
( 123 ) .
we now return to the problem of picking a tractable variational parameterization for a given graphical model .
we wish to pick a simplied graph which is both rich enough to provide
jordan et al .
distributions that are close to the true distribution , and simple enough so that an exact algo - rithm can be utilized efciently for calculations under the approximate distribution .
similar considerations hold for the variational parameterization : the variational parameterization must be representationally rich so that good approximations are available and yet simple enough so that a procedure that minimizes the kl divergence has some hope of nding good parameters and not getting stuck in a local minimum .
it is not necessarily possible to realize all of these desiderata simultaneously; however , in a number of cases it has been found that relatively simple variational approximations can yield reasonably accurate solutions .
in this section we discuss several such examples .
mean eld boltzmann machine .
in section 123 we discussed a sequential variational algorithm that yielded upper and lower bounds for the boltzmann machine .
we now revisit the boltzmann machine within the context of the block approach and discuss lower bounds .
we also relate the two approaches .
recall that the joint probability for the boltzmann machine can be written as follows :
p . s j ( cid : 123 ) / d exp
( cid : 123 ) i j si s j cp
where ( cid : 123 ) i j d 123 for nodes si and s j that are not neighbors in the graph .
consider now the representation of the conditional distribution p . h j e ; ( cid : 123 ) / in a boltzmann machine .
for nodes si 123 e and s j 123 e , the contribution ( cid : 123 ) i j si s j reduces to a constant , which vanishes when we normalize .
if si 123 h and s j 123 e , the quadratic contribution becomes a linear contribution that we associate with node si .
finally , linear terms associated with nodes si 123 e also become constants and vanish .
in summary , we can express the conditional distribution p . h j e ; ( cid : 123 ) / as follows :
( cid : 123 ) i j si s j cp
where the sums are restricted to range over nodes in h and the updated parameters ( cid : 123 ) c include contributions associated with the evidence nodes :
p . h j e ; ( cid : 123 ) / d exp
d ( cid : 123 ) i123 c
( cid : 123 ) i j s j :
the updated partition function zc is given as follows :
( cid : 123 ) i j si s j c
in sum , we have a boltzmann machine on the subset h .
the mean eld approximation ( peterson & anderson , 123 ) for boltzmann machines is a particular form of variational approximation in which a completely factorized distribution
introduction to variational methods
( a ) a node si in a boltzmann machine with its markov blanket .
( b ) the approximating mean eld distribution q is based on a graph with no edges .
the mean eld equations yield a deterministic relationship , represented in the gure with the dotted lines , between the variational parameters i and j for nodes j in the markov blanket of node i .
is used to approximate p . h j e ; ( cid : 123 ) / .
that is , we consider the simplest possible approxi - mating distribution; one that is obtained by dropping all of the edges in the boltzmann graph ( see gure 123 ) .
for this choice of q . h j e ; / , ( where we now use to represent the variational parameters ) , we have little choice as to the variational parameterizationto represent as large an approximating family as possible we endow each degree of freedom si with its own variational parameter i .
thus q can be written as follows :
q . h j e ; / d
. 123 i / 123si ;
where the product is taken over the hidden nodes h .
forming the kl divergence between the fully factorized q distribution and the p distri -
bution in eq .
( 123 ) , we obtain :
d . q k p / d
( i ln i c . 123 i / ln . 123 i / ) ( cid : 123 ) i j i j i c ln zc;
where the sums range across nodes in h .
in deriving this result we have used the fact that , under the q distribution , si and s j are independent random variables with mean values i and j .
we now take derivatives of the kl divergence with respect to i noting that zc is
independent of i and set the derivative to zero to obtain the following equations :
i d ( cid : 123 )
( cid : 123 ) i j j c ( cid : 123 ) i123
where ( cid : 123 ) . z / d 123= . 123 c e z / is the logistic function and we dene ( cid : 123 ) i j equal to ( cid : 123 ) ji for j < i .
equation ( 123 ) denes a set of coupled equations known as the mean eld equations .
jordan et al .
these equations are solved iteratively for a xed point solution .
note that each variational parameter i updates its value based on a sum across the variational parameters in its markov blanket ( cf .
gure 123 ( b ) ) .
this can be viewed as a variational form of a local message passing algorithm .
peterson and anderson ( 123 ) compared the mean eld approximation to gibbs sampling on a set of test cases and found that it ran 123 times faster , while yielding a roughly equivalent level of accuracy .
there are cases , however , in which the mean eld approximation is known to break down .
these cases include sparse boltzmann machines and boltzmann machines with frustrated interactions; these are networks whose potential functions embody constraints between neighboring nodes that cannot be simultaneously satised ( see also galland , 123 ) .
in the case of sparse networks , exact algorithms can provide help; indeed , this observation led to the use of exact algorithms as subroutines within the structured mean eld approach pursued by saul and jordan ( 123 ) .
let us now consider the parameter estimation problem for boltzmann machines .
writing
out the lower bound in eq .
( 123 ) for this case , we have : i ln z
ln p . e j ( cid : 123 ) /
( cid : 123 ) i j i j c
( i ln i c . 123 i / ln . 123 i / )
taking the derivative with respect to ( cid : 123 ) i j yields a gradient which has a simple hebbian term i j as well as a contribution from the derivative of ln z with respect to ( cid : 123 ) i j .
it is not hard to show that this derivative is hsi s ji; where the brackets signify an average with respect to the unconditional distribution p . s j ( cid : 123 ) / .
thus we have the following gradient algorithm for performing an approximate m step :
123 ( cid : 123 ) i j / . i j hsi s ji / :
unfortunately , however , given our assumption that calculations under the boltzmann dis - tribution are intractable for the graph under consideration , it is intractable to compute the unconditional average .
we can once again appeal to mean eld theory and compute an approximation to hsi s ji , where we now use a factorized distribution on all of the nodes; however , the m step is now a difference of gradients of two different bounds and is therefore no longer guaranteed to increase l .
there is a more serious problem , moreover , which is particularly salient in unsupervised learning problems .
if the data set of interest is a het - erogeneous collection of sub - populations , such as in unsupervised classication problems , the unconditional distribution will generally be required to have multiple modes .
unfortu - nately the factorized mean eld approximation is unimodal and is a poor approximation for a multi - modal distribution .
one approach to this problem is to utilize multi - modal q distributions within the mean - eld framework; for example , jaakkola and jordan ( 123a ) discuss the use of mixture models as approximating distributions .
these issues nd a more satisfactory treatment in the context of directed graphs , as we see in the following section .
in particular , the gradient for a directed graph ( cf .
( 123 ) ) does not require averages under the unconditional distribution .
introduction to variational methods
finally , let us consider the relationship between the mean eld approximation and the lower bounds that we obtained via a sequential algorithm in section 123 .
in fact , if we run the latter algorithm until all nodes are eliminated from the graph , we obtain a bound that is identical to the mean eld bound ( jaakkola , 123 ) .
to see this , note that for a boltzmann machine in which all of the nodes have been eliminated there are no quadratic and linear terms; only the constant terms remain .
recall from section 123 that the constant that arises when node i is removed is l been updated to absorb the linear terms from previously eliminated nodes j < i .
( recall that the latter update is given by q ( cid : 123 ) i123 d ( cid : 123 ) i123 c l ( cid : 123 ) i j for the removal of a particular node j that is a neighbor of i ) .
collecting together such updates for j < i , and summing across all nodes i , we nd that the resulting constant term is given as follows :
/ , where o ( cid : 123 ) i123 refers to the value of ( cid : 123 ) i123 after it has
o ( cid : 123 ) i123 c h . l
fo ( cid : 123 ) i123i c h . i / g d
( i ln i c . 123 i / ln . 123 i / )
this differs from the lower bound in eq .
( 123 ) only by the term ln z , which disappears when we maximize with respect to i .
( cid : 123 ) i j i j c
neural networks .
as discussed in section 123 , the sigmoid belief network is essen - tially a ( directed ) neural network with graphical model semantics .
we utilize the logistic function as the node probability function :
si d 123 j s . i /
123 c exp
j123i / ( cid : 123 ) i j s j ( cid : 123 ) i123
where we assume that ( cid : 123 ) i j d 123 unless j is a parent of i .
( in particular , ( cid : 123 ) i j 123d 123 ) ( cid : 123 ) ji d 123 ) .
noting that the probabilities for both the si d 123 case and the si d 123 case can be written in a single expression as follows :
j123i / ( cid : 123 ) i j s j c ( cid : 123 ) i123 123 c exp j123i / ( cid : 123 ) i j s j c ( cid : 123 ) i123 123 c exp
j123i / ( cid : 123 ) i j s j c ( cid : 123 ) i123
j123i / ( cid : 123 ) i j s j c ( cid : 123 ) i123
si j s . i /
p . s j ( cid : 123 ) / d
we obtain the following representation for the joint distribution :
we wish to calculate conditional probabilities under this joint distribution .
as we have seen ( cf .
gure 123 ) , inference for general sigmoid belief networks is intractable , and thus it is sensible to consider variational approximations .
saul , jaakkola , and jordan
jordan et al .
( 123 ) and saul and jordan ( 123 ) have explored the viability of the simple completely factorized distribution .
thus once again we set :
q . h j e ; / d
. 123 i / 123si ;
and attempt to nd the best such approximation by varying the parameters i .
the computation of the kl divergence d . q k p / proceeds much as it does in the case of the mean eld boltzmann machine .
the entropy term ( q ln q ) is the same as before .
the energy term ( q ln p ) is found by taking the logarithm of eq .
( 123 ) and averaging with respect to q .
putting these results together , we obtain :
ln p . e j ( cid : 123 ) /
123 c exp
( cid : 123 ) i j s j c ( cid : 123 ) i123
( cid : 123 ) i j i j c
( i ln i c . 123 i / ln . 123 i / )
where hi denotes an average with respect to the q distribution , and where we have abused notation by dening i values for i 123 e; these are set to the instantiated values i 123 f123; 123g .
note that , despite the fact that q is factorized , we are unable to calculate the average j123i / ( cid : 123 ) i j s j c ( cid : 123 ) i123
this is an important term which of ln ( 123 c ezi ) , where zi denotes arises directly from the directed nature of the sigmoid belief network ( it arises from the denominator of the sigmoid , a factor which is necessary to dene the sigmoid as a local conditional probability ) .
to deal with this term , saul et al .
( 123 ) introduced an additional variational transformation , due to seung ( 123 ) , that can be viewed as a rened form of jensens inequality .
in particular : hln ( 123 c ezi ) i d hln ( ei zi e
d ihzii c
i zi . 123 c ezi / i
ihzii c ln
i zi c e . 123i / zi i zi c e . 123i / zi
where i is a variational parameter .
( note that the inequality reduces to the standard jensen inequality for i d 123 ) .
the nal result can be utilized directly in eq .
( 123 ) to provide a tractable lower bound on the log likelihood and the variational parameter i can be optimized along with the other variational parameters .
saul and jordan ( 123 ) show that in the limiting case of networks in which each hidden node has a large number of parents , so that a central limit theorem can be invoked , the parameter i has a probabilistic interpretation as the approximate expectation of ( cid : 123 ) . zi / , where ( cid : 123 ) . / is again the logistic function .
introduction to variational methods
( a ) a node si in a sigmoid belief network machine with its markov blanket .
( b ) the mean eld equations yield a deterministic relationship , represented in the gure with the dotted lines , between the variational parameters i and j for nodes j in the markov blanket of node i .
for xed values of the parameters i , by differentiating the kl divergence with respect
to the variational parameters i , we obtain the following consistency equations :
i d ( cid : 123 )
( cid : 123 ) i j j c ( cid : 123 ) i123 c
( cid : 123 ) ji .
j j / c
j z j c e . 123 j / z ji with respect to i .
as saul et al .
where k ji is the derivative of lnhe show , this term depends on node i , its child j , and the other parents ( the co - parents ) of node j .
given that the rst term is a sum over contributions from the parents of node i , and the second term is a sum over contributions from the children of node i , we see that the consistency equation for a given node again involves contributions from the markov blanket of the node ( see gure 123 ) .
thus , as in the case of the boltzmann machine , we nd that the variational parameters are linked via their markov blankets and the consistency equation ( eq .
( 123 ) ) can be interpreted as a local message - passing algorithm .
saul , jaakkola , and jordan ( 123 ) and saul and jordan ( 123 ) also show how to update the variational parameters i .
the two papers utilize these parameters in slightly different ways and obtain different update equations .
( yet another related variational approximation for the sigmoid belief network , including both upper and lower bounds , is presented in jaakkola and jordan , 123 ) .
finally , we can compute the gradient with respect to the parameters ( cid : 123 ) i j for xed variational parameters and .
the result obtained by saul and jordan ( 123 ) takes the following form :
123 ( cid : 123 ) i j / . i i / j ( cid : 123 ) i j i . 123 i / i . 123 i / :
note that there is no need to calculate variational parameters under the unconditional distri - bution , p . s j ( cid : 123 ) / , as in the case of the boltzmann machine ( a fact rst noted by neal , 123 ) .
jordan et al .
figure 123
the leftmost gure shows examples of the images used by saul and jordan ( 123 ) in training their handwritten digit classier .
the rightmost gure shows examples of images whose bottom halves were inferred from their top halves via a variational inference algorithm .
note also the interesting appearance of a regularization termthe second term in the equation is a weight decay term that is maximal for non - extreme values of the varia - tional parameters ( both of these parameters are bounded between zero and one ) .
thus , this computationally - motivated approximation to maximum likelihood estimation is in fact a form of penalized maximum likelihood estimation .
saul and jordan ( 123 ) tested the sigmoid belief network on a handwritten digit clas - sication problem , obtaining results that were competitive with other supervised learning systems .
examples of the digits that saul and jordan used are shown in gure 123
figure 123 also illustrates the ability of a sigmoid belief network to ll in missing data .
all of the pixels in the bottom halves of these images were treated as missing and their values were inferred via variational inference equations .
as a result of this capacity for lling in missing data , the degradation in classication performance with missing pixels is slight; indeed , saul and jordan reported that the classication error went from 123 percent to 123 percent when half of the pixels were missing .
for further comparative empirical work on sigmoid belief networks and related architec -
tures , including comparisons with gibbs sampling , see frey , hinton , and dayan ( 123 ) .
factorial hidden markov models .
the factorial hidden markov model ( fhmm ) is a multiple chain structure ( see gure 123 ( a ) ) .
using the notation developed earlier ( see section 123 ) , the joint probability distribution for the fhmm is given by :
;fytg j ( cid : 123 )
computation under this probability distribution is generally infeasible because , as we saw earlier , the clique size becomes unmanageably large when the fhmm chain structure is moralized and triangulated .
thus it is necessary to consider approximations .
introduction to variational methods
( a ) the fhmm .
( b ) a variational approximation for the fhmm can be obtained by picking out a tractable substructure in the fhmm graph .
parameterizing this graph leads to a family of tractable approximating
for the fhmm there is a natural substructure on which to base a variational algorithm .
in particular , the chains that compose the fhmm are individually tractable .
therefore , rather than removing all of the edges , as in the naive mean eld approximation discussed in the previous two sections , it would seem more reasonable to remove only as many edges as are necessary to decouple the chains .
in particular , we remove the edges that link the state nodes to the output nodes ( see gure 123 ( b ) ) .
without these edges the moralization process no longer links the state nodes and no longer creates large cliques .
in fact , the moralization process on the delinked graph in gure 123 ( b ) is vacuous , as is the triangulation .
thus the cliques on the delinked graph are of size n 123 , where n is the number of states for a single chain .
one iteration of approximate inference runs in time o . mt n 123 / , where m is the number of chains and t is the length of the time series .
let us now consider how to express a variational approximation using the delinked graph of gure 123 ( b ) as an approximation .
the idea is to introduce one free parameter into the approximating probability distribution , q , for each edge that we have dropped .
these free parameters , which we denote as . m / , essentially serve as surrogates for the effect of the observation at time t on state component m .
when we optimize the divergence d . q k p / with respect to these parameters they become interdependent; this ( deterministic ) interdependence can be viewed as an approximation to the probabilistic dependence that is captured in an exact algorithm via the moralization process .
referring to gure 123 ( b ) , we write the approximating q distribution in the following
where is the vector of variational parameters . m / to be the product of the exact transition matrix a . m / and the variational parameter . m /
we dene the transition matrix qa . m /
and similarly for the initial state probabilities q . m / :
jordan et al .
this family of distributions respects the conditional independence statements of the ap - proximate graph in gure 123 , and provides additional degrees of freedom via the variational
ghahramani and jordan ( 123 ) present the equations that result from minimizing the kl divergence between the approximating probability distribution ( eq .
( 123 ) ) and the true probability distribution ( eq .
the result can be summarized as follows .
as in the other architectures that we have discussed , the equation for a variational parameter ( . m / ) is a function of terms that are in the markov blanket of the corresponding delinked node ( i . e . , , for n 123d m , thus linking yt ) .
in particular , the update for . m / depends on the parameters . n / the variational parameters at time t .
moreover , the update for . m / depends on the expected value of the states x . m / , where the expectation is taken under the distribution q .
given that the chains are decoupled under q , expectations are found by running one of the exact algorithms ( for example , the forward - backward algorithm for hmms ) , separately for each chain .
these expectations of course depend on the current values of the parameters . m / ( cf .
( 123 ) ) , and it is this dependence that effectively couples the chains .
to summarize , tting the variational parameters for a fhmm is an iterative , two - phase procedure .
in the rst phase , an exact algorithm is run as a subroutine to calculate expec - tations for the hidden states .
this is done independently for each of the m chains , making reference to the current values of the parameters . m / .
in the second phase , the parameters are updated based on the expectations computed in the rst phase .
the procedure then returns to the rst phase and iterates .
ghahramani and jordan ( 123 ) reported results on tting an fhmm to the bach chorale data set ( merz & murphy , 123 ) .
they showed that signicantly larger effective state spaces could be t with the fhmm than with an unstructured hmm , and that performance in terms of probability of the test set was an order of magnitude larger for the fhmm .
moreover , evidence of overtting was seen for the hmm for 123 states or more; no evidence of overtting for the fhmm was seen for up to 123 states .
hidden markov decision trees .
as a nal example we return to the hidden markov decision tree ( hmdt ) described in the introduction and briey discuss variational approxi - mation for this architecture .
as we have discussed , a hmdt is essentially a markov time series model , where the probability model at each time step is a ( probabilistic ) decision tree with hidden decision nodes .
the markovian dependence is obtained via separate transition matrices at the different levels of the decision tree , giving the model a factorized structure .
the variational approach to tting a hmdt is closely related to that of tting a fhmm; however , there are additional choices as to the variational approximation .
in particular , we have two substructures worth considering in the hmdt : ( 123 ) dropping the vertical edges , we recover a decoupled set of chains .
as in the fhmm , these chains can each be handled by the forward - backward algorithm .
( 123 ) dropping the horizontal edges , we recover a decoupled set of decision trees .
we can calculate probabilities in these trees using the posterior propagation algorithm described in jordan ( 123 ) .
the rst approach , which we refer to as the forest of chains approximation , is shown in gure 123
as in the fhmm , we write a variational approximation for the forest of chains approximation by respecting the conditional independencies in the approximating graph
introduction to variational methods
figure 123
the forest of chains approximation for the hmdt .
parameterizing this graph leads to an approxi - mating family of q distributions .
figure 123
the forest of trees approximation for the hmdt .
parameterizing this graph leads to an approxi - mating family of q distributions .
and incorporating variational parameters to obtain extra degrees of freedom ( see jordan et al . , 123 , for the details ) .
we can also consider a forest of trees approximation in which the horizontal links are eliminated ( see gure 123 ) .
given that the decision tree is a fully connected graph , this is essentially a naive mean eld approximation on a hypergraph .
finally , it is also possible to develop a variational algorithm for the hmdt that is analo - gous to the viterbi algorithm for hmms .
in particular , we utilize an approximation q that assigns probability one to a single path in the state space .
the kl divergence for this q distribution is particularly easy to evaluate , given that the entropy contribution to the kl divergence ( i . e . , the q ln q term ) is zero .
moreover , the evaluation of the energy ( i . e . , the q ln p term ) reduces to substituting the states along the chosen path into the p distribution .
the resulting algorithm involves a subroutine in which a standard viterbi algorithm is run on a single chain , with the other chains held xed .
this subroutine is run on each chain
jordan et al .
( 123 ) found that performance of the hmdt on the bach chorales was essentially the same as that of the fhmm .
the advantage of the hmdt was its greater interpretability; most of the runs resulted in a coarse - to - ne ordering of the temporal scales of the markov processes from the top to the bottom of the tree .
jordan et al .
we have described a variety of applications of variational methods to problems of inference and learning in graphical models .
we hope to have convinced the reader that variational methods can provide a powerful and elegant tool for graphical models , and that the algo - rithms that result are simple and intuitively appealing .
it is important to emphasize , however , that research on variational methods for graphical models is of quite recent origin , and there are many open problems and unresolved issues .
in this section we discuss a number of these issues .
we also broaden the scope of the presentation and discuss a number of related strands of research .
related research
the methods that we have discussed all involve deterministic , iterative approximation al - gorithms .
it is of interest to discuss related approximation schemes that are either non - deterministic or non - iterative .
recognition models and the helmholtz machine .
all of the algorithms that we have presented have at their core a nonlinear optimization problem .
in particular , after having introduced the variational parameters , whether sequentially or as a block , we are left with a bound such as that in eq .
( 123 ) that must be optimized .
optimization of this bound is generally achieved via a xed - point iteration or a gradient - based algorithm .
this iterative optimization process induces interdependencies between the variational parameters which give us a best approximation to the marginal or conditional probability of interest .
consider in particular a problem in which a directed graphical model is used for unsu - pervised learning .
a common approach in unsupervised learning is to consider graphical models that are oriented in the generative direction; that is , they point from hidden vari - ables to observables .
in this case the predictive calculation of p . e j h / is elementary .
the calculation of p . h j e / , on the other hand , is a diagnostic calculation that proceeds backwards in the graph .
diagnostic calculations are generally non - trivial and require the full power of an inference algorithm .
an alternative approach to solving iteratively for an approximation to the diagnostic calculation is to learn both a generative model and a recognition model that approximates the diagnostic distribution p . h j e / .
thus we associate different parameters with the gene - rative model and the recognition model and rely on the parameter estimation process to bring these parameterizations into register .
this is the basic idea behind the helmholtz machine ( dayan et al . , 123; hinton et al . , 123 ) .
the key advantage of the recognition - model approach is that the calculation of p . h j e /
is reduced to an elementary feedforward calculation that can be performed quickly .
there are some disadvantages to the approach as well .
in particular , the lack of an iterative algorithm makes the helmholtz machine unable to deal naturally with missing data , and with phenomena such as explaining - away , in which the couplings between hidden variables change as a function of the conditioning variables .
moreover , although in some cases there is a clear natural parameterization for the recognition model that is
introduction to variational methods
induced from the generative model ( in particular for linear models such as factor analysis ) , in general it is difcult to insure that the models are matched appropriately . 123 some of these problems might be addressed by combining the recognition - model approach with the iterative variational approach; essentially treating the recognition - model as a cache for storing good initializations for the variational parameters .
sampling methods .
in this section we make a few remarks on the relationships between variational methods and stochastic methods , in particular the gibbs sampler .
in the setting of graphical models , both classes of methods rely on extensive message - passing .
in gibbs sampling , the message - passing is particularly simple : each node learns the cur - rent instantiation of its markov blanket .
with enough samples the node can estimate the distribution over its markov blanket and ( roughly speaking ) determine its own statistics .
the advantage of this scheme is that in the limit of very many samples , it is guaranteed to converge to the correct statistics .
the disadvantage is that very many samples may be
the message - passing in variational methods is quite different .
its purpose is to couple the variational parameters of one node to those of its markov blanket .
the messages do not come in the form of samples , but rather in the form of approximate statistics ( as summarized by the variational parameters ) .
for example , in a network of binary nodes , while the gibbs sampler is circulating messages of binary vectors that correspond to the instantiations of markov blankets , the variational methods are circulating real - valued numbers that correspond to the statistics of markov blankets .
this may be one reason why variational methods often converge faster than gibbs sampling .
of course , the disadvantage of these schemes is that they do not necessarily converge to the correct statistics .
on the other hand , they can provide bounds on marginal probabilities that are quite difcult to estimate by sampling .
indeed , sampling - based methodswhile well - suited to estimating the statistics of individual hidden h p . h; e / .
an interesting direction for future research is to consider combinations of sampling methods and variational methods .
some initial work in this direction has been done by hinton , sallans , and ghahramani ( 123 ) , who discuss brief gibbs sampling from the point of view of variational approximation .
nodesare ill - equipped to compute marginal probabilities such as p . e / dp
bayesian methods .
variational inference can be applied to the general problem of bayesian parameter estimation .
indeed we can quite generally treat parameters as additional nodes in a graphical model ( cf .
heckerman , 123 ) and thereby treat bayesian inference on the same footing as generic probabilistic inference in a graphical model .
this probabilistic inference problem is often intractable , and variational approximations can be useful .
a variational method known as ensemble learning was originally introduced as a way of tting an ensemble of neural networks to data , where each setting of the parameters can be thought of as a different member of the ensemble ( hinton & van camp , 123 ) .
let q . ( cid : 123 ) j e / represent a variational approximation to the posterior distribution p . ( cid : 123 ) j e / .
the ensemble is t by minimizing the appropriate kl divergence :
k l . q k p / d
q . ( cid : 123 ) j e / ln
q . ( cid : 123 ) j e / p . ( cid : 123 ) j e /
jordan et al .
following the same line of argument as in section 123 , we know that this minimization must be equivalent to the maximization of a lower bound .
in particular , copying the argument from section 123 , we nd that minimizing the kl divergence yields the best lower bound on the following quantity :
ln p . e / d ln
p . e j ( cid : 123 ) / p . ( cid : 123 ) / d ( cid : 123 ) ;
which is the logarithm of the marginal likelihood; a key quantity in bayesian model selection and model averaging .
more recently , the ensemble learning approach has been applied to mixture of experts ar - chitectures ( waterhouse , mackay , & robinson , 123 ) and hidden markov models ( mackay , 123 ) .
one interesting aspect of these applications is that they do not assume any particular parametric family for q , rather they make the nonparametric assumption that q factorizes in a specic way .
the variational minimization itself determines the best family given this factorization and the prior on ( cid : 123 ) .
jaakkola and jordan ( 123b ) have also developed variational methods for bayesian in - ference , using a variational approach to nd an analytically tractable approximation for logistic regression with a gaussian prior on the parameters .
perspective and prospectives .
perhaps the key issue that faces developers of vari - ational methods is the issue of approximation accuracy .
one can develop an intuition for when variational methods perform well and when they perform poorly by examining their properties in certain well - studied cases .
in the case of fully factorized approximations for undirected graphs , a good starting point is the statistical mechanics literature where this approximation can give not only good , but indeed exact , results .
such cases include densely connected graphs with uniformly weak ( but non - negative ) couplings between neighboring nodes ( parisi , 123 ) .
the mean eld equations for these networks have a unique solution that determines the statistics of individual nodes in the limit of very large graphs .
kearns and saul ( 123 ) have utilized large deviation methods to study the approximation accuracy of bounds on the likelihood for dense directed graphs .
characterizing the accuracy in terms of the number n of parents for each node ( assumed constant ) in a layered graph , they have shown that the gap between variational upper and lower bounds converges at a rate of ln . n / =n / .
their approach utilizes a rather general form of upper and lower bounds for the local conditional probabilities that does not depend on convexity properties .
thus their result should be expected to be rather robust across the general family of variational methods; moreover , faster rates may be obtainable for the convexity - based variational approximations discussed in the current paper .
in more general graphical models the conditions for convergence of fully factorized variational approximations may not be so favorable .
in general some nodes may have a small markov blanket or may be strongly dependent on particular neighbors , and variational transformations of such nodes would yield poor bounds .
more globally , if there are strong probabilistic dependencies in the model the posterior can have multiple modes ( indeed , in the limiting case of deterministic relationships one can readily create switching automata that have multiple modes ) .
fully factorized approximations , which are necessarily unimodal ,
introduction to variational methods
will fail in such cases .
handling such cases requires making use of methods that transform only a subset of the nodes , incorporating exact inferential procedures as subroutines to handle the untransformed structure .
the exact methods can capture the strong dependencies , leaving the weaker dependencies for the variational transformations .
in practice , achieving this kind of division of labor either requires that the strong dependencies can be identied in advance by inspection of the graph , or can be identied in the context of a sequential variational method via simple greedy calculations .
an alternative approach to handling multiple modes is to utilize mixture models as approximating distributions ( the q distributions in block variational methods ) .
see jaakkola and jordan ( 123a ) and bishop et al .
( 123 ) for discussion of this approach .
finally , it is also important to stress the difference between joint distributions p . h; e / , and conditional distributions p . h j e / .
in many situations , such as classication problems in which h represents a category label , the joint distribution p . h; e / is multi - modal , but the conditional distribution p . h j e / is not .
thus factorized approximations may make sense for inference problems even when they would be poor overall approximations to the joint probability model .
another key issue has to do with broadening the scope of variational methods .
in this paper we have presented a restricted set of variational techniques , those based on convexity transformations .
for these techniques to be applicable the appropriate convexity properties need to be identied .
while it is relatively easy to characterize small classes of models where these properties lead to simple approximation algorithms , such as the case in which the local conditional probabilities are log - concave generalized linear models , it is not generally easy to develop variational algorithms for other kinds of graphical models .
a broader characterization of variational approximations is needed and a more systematic algebra is needed to match the approximations to models .
other open problems include : ( 123 ) the problem of combining variational methods with sampling methods and with search based methods , ( 123 ) the problem of making more in - formed choices of node ordering in the case of sequential methods , ( 123 ) the development of upper bounds within the block framework , ( 123 ) the combination of multiple variational approximations for the same model , and ( 123 ) the development of variational methods for architectures that combine continuous and discrete random variables .
similar open problems exist for sampling methods and for methods based on incomplete or pruned versions of exact methods .
the difculty in providing solid theoretical foundations in all of these cases lies in the fact that accuracy is contingent to a large degree on the actual conditional probability values of the underlying probability model rather than on the discrete properties of the graph .
in this section , we calculate the conjugate functions for the logarithm function and the log
for f . x / d ln x , we have :
. / d min
fx ln xg :
jordan et al .
taking the derivative with respect to x and setting to zero yields x d 123
substituting back in eq .
( a . 123 ) yields :
. / d ln c 123;
which justies the representation of the logarithm given in eq
for the log logistic function g . x / d ln . 123 c e
x / , we have :
. / d min
fx c ln . 123 c e
taking the derivative with respect to x and setting to zero yields :
123 c ex
from which we obtain :
x d ln
ln . 123 c e
x / d ln
plugging these expressions back into eq .
( a . 123 ) yields :
. / d ln . 123 / ln . 123 / ;
which is the binary entropy function h . / .
this justies the representation of the logistic function given in eq
we wish to thank brendan frey , david heckerman , uffe kjrulff , and ( as always ) peter dayan for helpful comments on the manuscript .
our presentation will take the point of view that moralization and triangulation , when combined with a local message - passing algorithm , are sufcient for exact inference .
it is also possible to show that , under certain conditions , these steps are necessary for exact inference .
see jensen and jensen ( 123 ) .
here and elsewhere we identify the ith node with the random variable si associated with the node .
we dene a clique to be a subset of nodes which are fully connected and maximal; i . e . , no additional node
can be added to the subset so that the subset remains fully connected .
note in particular that gure 123 is the moralization of gure 123
introduction to variational methods
the acronym qmr - dt refers to the decision theoretic version of the quick medical reference .
in particular , the pattern of missing edges in the graph implies that ( a ) the diseases are marginally independent ,
and ( b ) given the diseases , the symptoms are conditionally independent .
jaakkola and jordan ( 123b ) also calculated the median of the pairwise cutset size .
this value was found to
be 123 , which also rules out exact cutset methods for inference for the qmr - dt .
it is also possible to consider more general boltzmann machines with multivalued nodes , and potentials that are exponentials of arbitrary functions on the cliques .
such models are essentially equivalent to the general undirected graphical model of eq .
( 123 ) ( although the latter can represent zero probabilities while the former
note that we treat p . h; e / in general as a marginal probability; that is , we do not necessarily assume that h
and e jointly exhaust the set of nodes s .
the particular recognition model utilized in the helmholtz machine is a layered graph , which makes weak conditional independence assumptions and thus makes it possible , in principle , to capture fairly general
